{
  "hash": "675fb4d6c5cb4d5daba2193c0c961549",
  "result": {
    "engine": "knitr",
    "markdown": "# tsiR\n\nTSIR stands for **Time series Susceptible-Infected-Recovered** model.\n\nFitting SIR-type models is challenging due to [@becker2017]:\n\n1.  Only one state variable (the number of cases over time) is observed.\n2.  Substantial under-reporting of disease incidence.\n3.  The model is a continuous-time process, whereas the data are discretely collected weekly or monthly.\n\nThe TSIR handle (2) by reconstructing the susceptible dynamics, and (3) by switching continuous to discrete time with an assumption such that the infectious period is equal to data collecting interval.\n\n## Assumptions\n\nThe TSIR model relies on two main assumptions [@becker2017]:\n\n-   Infectious period is fixed at the sampling interval of the data (e.g., bi-weekly for measles). The time step of the model is equal to the infectious period.\n-   Over a long enough time (e.g., 10-20 years), the sum of births and cases should be approximately equal due to the high infectivity of pathogens such as measles and other childhood infections, in the pre-vaccine era.\n\n## Model\n\n$$\\mathbb{E}(I_{t + 1}) = \\beta_{t + 1} S_t I_t^{\\alpha}$$\n\n::: {.callout-note collapse=\"true\"}\n## Explain\n\nThis equation describes the transmission through the multiplicative interaction between susceptible and infected individuals [@finkenstädt2000].\n\n$$I_{t + 1} = \\beta_{t + 1} S_t^{\\alpha_1} I_t^{\\alpha_2} \\epsilon_t$$\n\n- Susceptible ($S_t$) meet infectious individuals ($I_t$) with contact rate $\\beta_{t + 1}$.\n- $\\alpha_1$ and $\\alpha_2$ are mixing parameters of the contact process, such that $\\alpha_1 = \\alpha_2 = 1$ is the homogeneous mixing.\n- $\\epsilon_t$ is the noise, $\\mathbb{E}\\{ log(\\epsilon_t) \\} = 0$ and $\\mathbb{V}\\{ log(\\epsilon_t) \\} = 0$.\n:::\n\n$$S_{t + 1} = B_{t + 1} + S_t - I_{t + 1}$$\n\n::: {.callout-note collapse=\"true\"}\n## Explain\n\nSusceptible class in the next time step recruited by births ($B_{t + 1}$) and depleted by the infected individuals leaving the class ($I_{t + 1}$) [@finkenstädt2000].\n:::\n\n## `tsiR` framework\n\n### Reconstruct susceptible dynamics\n\nFit a regression between cumulative cases and cumulative births. The slope is assumed to be the report rate $\\rho_t$ (rho) [@du2017], the residuals is assumed to be the shape of the susceptible dynamics ($Z_t$).\n\n::: {.callout-note collapse=\"true\"}\n## Explain\n\nLet $\\rho_t$ be the reporting rate and assume $\\rho_t$ has a probability function with expected value $\\mathbb{E}(\\rho_t) = \\rho$.\n\n$$I_t = \\rho_t C_t$$\n\n-   $I_t$: the number of true cases.\n-   $C_t$: the number of reported cases.\n\nThe number of true cases is under-reported if $\\rho_t > 1$ and is fully reported if $\\rho_t = 1$.\n\nReplace $I_t$ here:\n\n$$S_t = B_t + S_{t - 1} - I_t$$\n\n$$S_t = B_t + S_{t - 1} - \\rho_t C_t$$\n\nLet $\\mathbb{E}(S_t) = \\bar{S}$ so that $S_t = \\bar{S} + Z_t$, with $\\mathbb{E}(Z_t) = 0$. The deviations $Z_t$ from their mean follow the same recursive relationship as $S_t$.\n\n$$Z_t = B_t + Z_{t - 1} - \\rho_t C_t$$\n\nA successive iteration to compute $Z_t$ from $Z_0$ gives:\n\n$$Z_t = \\sum_{i = 1}^{t} B_i + Z_0 - \\sum_{i = 1}^{t} \\rho_i C_i$$\n\n- $\\sum_{i = 1}^{t} B_i$: cumulative births.\n- $\\sum_{i = 1}^{t} C_i$: cumulative reported cases.\n\nFor ease of notation, let $Y_\\text{cumBirths} = \\sum_{i = 1}^{t} B_i$, $X_\\text{cumCases} = \\sum_{i = 1}^{t} C_i$, rearrange that equation so that we have:\n\n$$Y_\\text{cumBirths} = \\rho X_\\text{cumCases} + Z_t - Z_0$$\n\nIf we assume a constant reporting rate, this equation is a simple linear regression relationship between cumulative births $Y$ and cumulative cases $X$.\n:::\n\n### Estimate parameters\n\nSet the expectation to the mean, then take log of both sides:\n\n$$\\mathbb{E}(I_{t + 1}) = \\beta_{t + 1} S_t I_t^{\\alpha}$$\n\n$$log I_{t + 1} = log \\beta_{t + 1} + log(Z_t + \\bar{S}) + \\alpha log I_t$$\n\n-   $\\bar{S}$: mean susceptible individuals across the time-series. $Z_t$ is the residuals or the shape of the susceptible dynamics, so $Z_t + \\bar{S} = S_t$\n-   $\\beta_t$: contact rate at time t.\n-   $\\alpha$: describes the epidemic saturation, a correction factor for switching from continuous to discrete time.\n\n## Basic reproduction number\n\n$$R_0 = \\beta \\times \\bar{S}$$\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tsiR)\n```\n:::\n\n\nThe London measles data is available in the `tsiR` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLondonMeas <- twentymeas[[\"London\"]]\nhead(LondonMeas)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"time\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"cases\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"births\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"pop\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1944.016\",\"2\":\"180\",\"3\":\"1725.038\",\"4\":\"2462500\",\"_rn_\":\"1\"},{\"1\":\"1944.055\",\"2\":\"271\",\"3\":\"1726.429\",\"4\":\"2467578\",\"_rn_\":\"2\"},{\"1\":\"1944.093\",\"2\":\"423\",\"3\":\"1727.820\",\"4\":\"2472655\",\"_rn_\":\"3\"},{\"1\":\"1944.131\",\"2\":\"465\",\"3\":\"1729.211\",\"4\":\"2477733\",\"_rn_\":\"4\"},{\"1\":\"1944.170\",\"2\":\"523\",\"3\":\"1730.602\",\"4\":\"2482810\",\"_rn_\":\"5\"},{\"1\":\"1944.208\",\"2\":\"649\",\"3\":\"1731.992\",\"4\":\"2487888\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThe data frame containing cases and interpolated births and populations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotdata(LondonMeas)\n```\n\n::: {.cell-output-display}\n![](tsir_files/figure-html/unnamed-chunk-3-1.svg)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nLondonRes <- runtsir(data = LondonMeas, IP = 2, xreg = \"cumcases\", regtype = \"gaussian\", alpha = NULL, sbar = NULL, method = \"negbin\", nsim = 100, family = \"gaussian\", link = \"identity\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           alpha        mean beta         mean rho         mean sus \n        9.60e-01         1.19e-05         4.57e-01         1.14e+05 \nprop. init. sus. prop. init. inf. \n        3.01e-02         6.12e-05 \n```\n\n\n:::\n:::\n\n\n-   `alpha`: describes the epidemic saturation, a correction factor for switching from continuous to discrete time.\n-   `mean beta`: mean of the contact rate across the time-series.\n-   `mean rho`: mean of the report rate across the time-series.\n-   `mean sus`: mean of the number of susceptible across the time-series.\n-   `prop. init. sus.`: proportion of the initial susceptible individuals.\n-   `prop. init. inf.`: proportion of the initial infectious individuals.\n\n### Reconstruct susceptible dynamics\n\nIn this step we compute the reported rate using cumulative births and cumulative reported cases.\n\n$$Y_\\text{cumBirths} = \\rho X_\\text{cumCases} + Z_t - Z_0$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotregression(LondonRes)\n```\n\n::: {.cell-output-display}\n![](tsir_files/figure-html/unnamed-chunk-5-1.svg)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplotrho(LondonRes)\n```\n\n::: {.cell-output-display}\n![](tsir_files/figure-html/unnamed-chunk-6-1.svg)\n:::\n:::\n\n\n### Estimate parameters\n\nHaving $\\rho$, we adjust the $I_t$ to estimate other parameters.\n\n$$I_t = \\rho_t C_t$$\n$$log I_{t + 1} = log \\beta_{t + 1} + log(Z_t + \\bar{S}) + \\alpha log I_t$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotres(LondonRes)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in geom_line(data = dat$res, aes_string(x = \"time\", y = \"cases\", :\nIgnoring unknown aesthetics: fill\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](tsir_files/figure-html/unnamed-chunk-7-1.svg)\n:::\n:::\n",
    "supporting": [
      "tsir_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}