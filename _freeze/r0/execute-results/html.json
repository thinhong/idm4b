{
  "hash": "16100e991e46022ec338d9dacad41d2a",
  "result": {
    "engine": "knitr",
    "markdown": "# Estimating $R_0$\n\nEstimations of the R0 value are often calculated as a function of 3 primary parameters [@jones2007; @chitnis2017]:\n\n$$R_0 = \\begin{pmatrix} \\text{Number of} \\\\ \\text{contacts} \\\\ \\text{per unit time} \\end{pmatrix} \\times \\begin{pmatrix} \\text{Probability of} \\\\ \\text{transmission} \\\\ \\text{per contact} \\end{pmatrix} \\times \\begin{pmatrix} \\text{Duration} \\\\ \\text{of} \\\\ \\text{infectious} \\end{pmatrix}$$\n\n## Exponential growth rate\n\nStep 1. Find an estimate for the mean generation time $T_g$.\n\nStep 2. Identify the exponential phase of the epidemic curve: the period of which $\\log(\\text{incidence})$ is linear.\n\nStep 3. Estimate the growth rate $r$ for that phase by finding the slope from the linear regression on the $\\log(\\text{incidence})$.\n\n::: {.callout-tip collapse=\"true\"}\n\n## Proof\n\nSee @sec-rnum-growthrate-r0 for more details. During the exponential phase, the incidence at time $t$ is given by:\n\n$$C_t = C_0 e^{rt}$$\n\nTake the natural logarithm:\n\n$$\\log C_t = log C_0 + rt$$\n\nTherefore $r$ is the slope from the linear regression on the $\\log(\\text{incidence})$.\n\n:::\n\nStep 4. Given the exponential growth rate $r$ and the $T_g$, calculate the basic reproduction number:\n\n- In an SIR model $T_g = \\frac{1}{\\gamma}$ so:\n\n$$R_0 \\approx 1 + \\frac{r}{\\gamma}$$\n\n- In an SEIR model $T_g = \\frac{1}{\\gamma} + \\frac{1}{\\sigma}$ so:\n\n$$R_0 \\approx \\left( 1 + \\frac{r}{\\gamma} \\right) \\left( 1 + \\frac{r}{\\sigma} \\right)$$\n\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(R0)\nlibrary(ggplot2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(\"data/flu_inc.csv\")\n\nggplot(df, aes(x = day, y = inc)) +\n  geom_point() +\n  labs(x = \"Day\", y = \"Incidence\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](r0_files/figure-html/unnamed-chunk-2-1.svg){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf$loginc <- log(df$inc)\n\nggplot(df, aes(x = day, y = loginc)) +\n  geom_point() +\n  labs(x = \"Day\", y = \"Log incidence\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](r0_files/figure-html/unnamed-chunk-3-1.svg){width=100%}\n:::\n\n```{.r .cell-code}\nlm(loginc ~ day, data = df[5:13,])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = loginc ~ day, data = df[5:13, ])\n\nCoefficients:\n(Intercept)          day  \n    0.53464      0.09831  \n```\n\n\n:::\n:::\n\n\n### \n\n\n::: {.cell}\n\n```{.r .cell-code}\n1 + 0.09*4\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.36\n```\n\n\n:::\n\n```{.r .cell-code}\ngt <- generation.time(\"gamma\", c(3, 1.5))\ntmp <- data.frame()\nest.R0.EG(df$inc, gt, begin = 5, end = 13)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWaiting for profiling to be done...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReproduction number estimate using  Exponential Growth  method.\nR :  1.483549[ 0.9715841 , 2.227934 ]\n```\n\n\n:::\n:::\n\n\n## Simple compartmental models\n\nConsider a simple closed population SIR model.\n\n$$\\begin{align} \\frac{dS}{dt} & = -\\beta SI \\\\ \\frac{dI}{dt} & = \\beta SI - \\gamma I\\\\ \\frac{dR}{dt} & = \\gamma I \\end{align}$$\n\nFocusing on the $I$ equation:\n\n$$\\frac{dI}{dt} = \\beta SI - \\gamma I = I (\\beta S - \\gamma)$$\n\nA disease spreads when:\n\n$$\\begin{align} \\frac{dI}{dt} & > 0 \\\\ \\Leftrightarrow I (\\beta S - \\gamma) & > 0 \\\\ \\Leftrightarrow \\beta S - \\gamma & > 0 \\\\ \\Leftrightarrow \\beta S & > \\gamma \\\\ \\Leftrightarrow \\frac{\\beta S}{\\gamma} & > 1 \\end{align}$$\n\nThis leads to the definition of $R_0$. By @def-r0, $R_0$ is the $R$ in a fully susceptible population $S_0$:\n\n$$R_0 = \\frac{\\beta S_0}{\\gamma}$$\n\nTherefore:\n\n-   $R_0 > 1$ meaning that $\\frac{dI}{dt} > 0$, then the disease will spread.\n-   $R_0 < 1$ meaning that $\\frac{dI}{dt} < 0$, then no epidemic occurs.\n\nFor more complex compartmental models, especially those with more infected compartments, as proposed by [@diekmann1990] and [@vandendriessche2002], $R_0$ can be determined using the next generation matrix [@vandendriessche2017].\n\n## Next generation matrix\n\n$R_0$ is the maximum absolute eigenvalue (also called the spectral radius) of the next generation matrix (NGM) [@vandendriessche2017].\n\nConsider a SEIR model with equal birth and death rate $\\mu$.\n\n$$\\begin{align} \\frac{dS}{dt} & = \\mu (S + E + I + R) -\\beta SI - \\mu S \\\\ \\frac{dE}{dt} & = \\beta SI - \\sigma E - \\mu E \\\\ \\frac{dI}{dt} & = \\sigma E - \\gamma I - \\mu I \\\\ \\frac{dR}{dt} & = \\gamma I - \\mu R \\end{align}$$\n\n**Step 1. Identify the infected compartments**\n\nFor our SEIR model, the infected compartments are $E$ and $I$.\n\n**Step 2. Write the NGM functions**\n\n-   $\\mathcal{F}_i(x)$: is the rate of appearance of new infections in compartment $i$ [@vandendriessche2017] (caused by contact).\n-   $\\mathcal{V}_i(x)$: is the rate of other transitions between compartment $i$ and other infected compartments [@vandendriessche2017] (caused by transition between compartments).\n\nFor our SEIR model, we would write $\\mathcal{F}$ and $\\mathcal{V}$ as follows:\n\n::: columns\n::: {.column width=\"50%\"}\n$$\\mathcal{F} = \\begin{bmatrix} \\beta SI \\\\ 0 \\end{bmatrix}$$ $\\mathcal{F}$ is a vector contains of $\\begin{bmatrix} \\mathcal{F}_1 \\\\ \\mathcal{F}_2 \\end{bmatrix}$:\n\n-   $\\mathcal{F}_1 = \\beta SI$: the rate of new infections (caused by contact) in compartment $E$.\n-   $\\mathcal{F}_2 = 0$: as there is no new infections (caused by contact) in compartment $I$.\n:::\n\n::: {.column width=\"50%\"}\n$$\\mathcal{V} = \\begin{bmatrix} \\sigma E + \\mu E \\\\ - \\sigma E + \\gamma I + \\mu I \\end{bmatrix}$$\n\n$\\mathcal{V}$ is a vector contains of $\\begin{bmatrix} \\mathcal{V}_1 \\\\ \\mathcal{V}_2 \\end{bmatrix}$:\n\n-   $\\mathcal{V}_1 = \\sigma E + \\mu E$: is the rate of other transitions to and from compartment $E$.\n-   $\\mathcal{V}_2 = - \\sigma E + \\gamma I + \\mu I$: is the rate of other transitions to and from compartment $I$.\n:::\n:::\n\n$\\mathcal{F}$ and $\\mathcal{V}$ are written such that:\n\n$$\\frac{dx}{dt} = \\mathcal{F} - \\mathcal{V}$$\n\nHere we have:\n\n$$\\frac{dE}{dt} = \\mathcal{F}_1 - \\mathcal{V}_1 = \\beta SI - (\\sigma E + \\mu E)$$\n\n$$\\frac{dI}{dt} = \\mathcal{F}_2 - \\mathcal{V}_2 = 0 - (- \\sigma E + \\gamma I + \\mu I)$$\n\n**Step 3. Find the Jacobian matrix**\n\nJacobian matrix $F$ for $\\mathcal{F}$, and $V$ for $\\mathcal{V}$. Jacobian matrix is a matrix contain all partial derivatives of a vector function.\n\n$$\\begin{align} F & = \\begin{bmatrix} \\frac{\\partial \\mathcal{F}_1}{\\partial E} & \\frac{\\partial \\mathcal{F}_1}{\\partial I} \\\\ \\frac{\\partial \\mathcal{F}_2}{\\partial E} & \\frac{\\partial \\mathcal{F}_2}{\\partial I} \\end{bmatrix} \\\\ & = \\begin{bmatrix} \\frac{\\partial [\\beta SI]}{\\partial E} & \\frac{\\partial [\\beta SI]}{\\partial I} \\\\ \\frac{\\partial [0]}{\\partial E} & \\frac{\\partial [0]}{\\partial I} \\end{bmatrix} \\\\ & = \\begin{bmatrix} 0 & \\beta S \\\\ 0 & 0 \\end{bmatrix} \\end{align}$$\n\nIn which:\n\n-   $\\frac{\\partial [\\beta SI]}{\\partial E} = 0$: because there is no $E$ in $\\beta SI$.\n-   $\\frac{\\partial [\\beta SI]}{\\partial I} = \\beta S$.\n\n$$\\begin{align} V & = \\begin{bmatrix} \\frac{\\partial \\mathcal{V}_1}{\\partial E} & \\frac{\\partial \\mathcal{V}_1}{\\partial I} \\\\ \\frac{\\partial \\mathcal{V}_2}{\\partial E} & \\frac{\\partial \\mathcal{V}_2}{\\partial I} \\end{bmatrix} \\\\ & = \\begin{bmatrix} \\frac{\\partial [\\sigma E + \\mu E]}{\\partial E} & \\frac{\\partial [\\sigma E + \\mu E]}{\\partial I} \\\\ \\frac{\\partial [- \\sigma E + \\gamma I + \\mu I]}{\\partial E} & \\frac{\\partial [- \\sigma E + \\gamma I + \\mu I]}{\\partial I} \\end{bmatrix} \\\\ & = \\begin{bmatrix} \\sigma + \\mu & 0 \\\\ - \\sigma & \\gamma + \\mu \\end{bmatrix} \\end{align}$$\n\n**Step 4. Compute the NGM**\n\nUse @def-inv-matrix to compute inverse matrix $V^{-1}$:\n\n$$\\begin{align} V^{-1} & = \\frac{1}{(\\sigma + \\mu)(\\gamma + \\mu)} \\begin{bmatrix} \\gamma + \\mu & - 0 \\\\ - \\sigma & \\sigma + \\mu \\end{bmatrix} \\\\& = \\begin{bmatrix} \\frac{1}{\\sigma + \\mu} & 0 \\\\ \\frac{\\sigma}{(\\sigma + \\mu)(\\gamma + \\mu)} & \\frac{1}{\\gamma + \\mu} \\end{bmatrix} \\end{align}$$\n\n$$\\begin{align} K & = FV^{-1} \\\\ & = \\begin{bmatrix} 0 & \\beta S \\\\ 0 & 0 \\end{bmatrix} \\begin{bmatrix} \\frac{1}{\\sigma + \\mu} & 0 \\\\ \\frac{\\sigma}{(\\sigma + \\mu)(\\gamma + \\mu)} & \\frac{1}{\\gamma + \\mu} \\end{bmatrix} \\\\ & = \\begin{bmatrix} \\frac{\\beta S \\sigma}{(\\sigma + \\mu)(\\gamma + \\mu)} & \\frac{\\beta S}{\\gamma + \\mu} \\\\ 0 & 0 \\end{bmatrix} \\end{align}$$\n\n::: {.callout-tip collapse=\"true\"}\n## What is a next generation matrix?\n\nSource: quantpie's [video](https://www.youtube.com/watch?v=xJ5mizenTII).\n\nA population consists of two groups: young and old.\n\n-   A young person on average infects 3 young and 2 old: $\\begin{bmatrix} 3 \\\\ 2 \\end{bmatrix}$.\n-   An old person on average infects 1 young and 2 old: $\\begin{bmatrix} 1 \\\\ 2 \\end{bmatrix}$.\n\nEach group becomes a column in the next generation matrix (NGM):\n\n$$\\text{NGM} = \\begin{bmatrix} 3 & 1 \\\\ 2 & 2 \\end{bmatrix}$$\n\n$R_0$ is the root of equation:\n\n$$\\begin{align} \\begin{bmatrix} 3 - \\lambda & 1 \\\\ 2 & 2 - \\lambda \\end{bmatrix} & = 0 \\\\ \\Leftrightarrow (3 - \\lambda) \\times (2 - \\lambda) - 2 \\times 1 & = 0 \\\\ \\Leftrightarrow \\lambda^2 - 5 \\lambda + 6 - 2 & = 0 \\\\ \\Leftrightarrow \\lambda^2 - 5 \\lambda + 4 & = 0 \\end{align}$$\n\nThere are two roots $\\lambda = 4$ and $\\lambda = 1$, for an outbreak to occur $R_0 > 1$, so here $R_0 = 4$.\n:::\n\n**Step 5. Compute** $R_0$\n\n$R_0$ is the eigenvalues of the NGM.\n\n$$\\begin{align} det(K - \\lambda) & = \\begin{bmatrix} \\frac{\\beta S \\sigma}{(\\sigma + \\mu)(\\gamma + \\mu)} - \\lambda & \\frac{\\beta S}{\\gamma + \\mu} \\\\ 0 & 0 - \\lambda \\end{bmatrix} \\\\ & = [\\frac{\\beta S \\sigma}{(\\sigma + \\mu)(\\gamma + \\mu)} - \\lambda][0 - \\lambda] \\end{align}$$\n\n$$R_0 = \\frac{\\beta S \\sigma}{(\\sigma + \\mu)(\\gamma + \\mu)}$$\n\n::: {.callout-note collapse=\"true\"}\n## Use NGM to compute $R_0$ for SIR model\n\nConsider a simple closed population SIR model.\n\n$$\\begin{align} \\frac{dS}{dt} & = -\\beta SI \\\\ \\frac{dI}{dt} & = \\beta SI - \\gamma I\\\\ \\frac{dR}{dt} & = \\gamma I \\end{align}$$\n\n**Step 1. Identify the infected compartments**\n\nFor our SIR model, the infected compartment is $I$.\n\n**Step 2. Write the NGM functions**\n\n$$\\mathcal{F} = \\beta SI$$\n\n$$\\mathcal{V} = \\gamma I$$\n\nSuch that we have:\n\n$$\\frac{dI}{dt} = \\mathcal{F} - \\mathcal{V} = \\beta SI - \\gamma I$$\n\n**Step 3. Find the Jacobian matrix**\n\n$$F = \\frac{\\partial \\mathcal{F}}{\\partial I} = \\frac{\\partial [\\beta SI]}{\\partial I} = \\beta S$$\n\n$$V = \\frac{\\partial \\mathcal{V}}{\\partial I} = \\frac{\\partial [\\gamma I]}{\\partial I} = \\gamma$$\n\n**Step 4 and 5. Compute the NGM and** $R_0$\n\n$$V^{-1} = \\gamma^{-1} = \\frac{1}{\\gamma}$$\n\n$$K = FV^{-1} = \\frac{\\beta S}{\\gamma}$$\n\nHere we also have $R_0$.\n\n$$R_0 = \\frac{\\beta S}{\\gamma}$$\n:::\n\n## Epidemic final size\n\nIf there were no interventions or changes in behavior, the proportion of the population infected during the entire course of an epidemic would be approximately the non-zero solution of the equation:\n\n\\$\\$\\$\\$\n",
    "supporting": [
      "r0_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}