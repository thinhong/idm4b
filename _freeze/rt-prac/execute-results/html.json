{
  "hash": "fd72babc38ef6f3b794b4d98242ff47f",
  "result": {
    "engine": "knitr",
    "markdown": "# $R_t$ in practice\n\n## Interpret $R_t$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(zoo)\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(EpiEstim)\nlibrary(janitor)\nlibrary(cowplot)\nlibrary(lubridate)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](rt-prac_files/figure-html/unnamed-chunk-2-1.svg){width=100%}\n:::\n:::\n\n\n## $R_t$ with color code\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndf <- readRDS(\"data/linelist.rds\")\ndf <- df |>\n  count(date_onset) |>\n  complete(date_onset = seq(date_onset[1], date_onset[length(date_onset)], by = \"days\"),\n           fill = list(n = 0))\n\ncolnames(df) <- c(\"dates\", \"I\")\ndf <- df |>\n  filter(dates > ymd(\"2023-02-24\"), dates < ymd(\"2023-06-23\"))\n\nmod <- estimate_R(incid = df,\n                  method = \"parametric_si\",\n                  config = make_config(list(mean_si = 4.5, std_si = 1.3)))\n\ndf_line <- mod$R\ndf_line$dates <- mod$dates[df_line$t_end]\ndf_line <- clean_names(df_line)\ndf_line <- df_line |>\n  clean_names() |>\n  mutate(\n    b_posterior = std_r ^ 2 / mean_r,\n    a_posterior = mean_r / b_posterior,\n    pct = pgamma(\n      1,\n      shape = a_posterior,\n      scale = b_posterior,\n      lower.tail = F\n    ),\n    trend = case_when(\n      pct > 0.9 ~ \"purple\",\n      pct > 0.75 & pct <= 0.9 ~ \"red\",\n      pct > 0.25 & pct <= 0.75 ~ \"orange\",\n      pct > 0.1 & pct <= 0.25 ~ \"yellow\",\n      pct <= 0.1 ~ \"green\"\n    )\n  )\ndf_line$trend <- factor(df_line$trend,\n                        levels = c(\"green\", \"yellow\", \"orange\", \"red\", \"purple\"))\n\ndf_ribbon <- df_line\ndf_ribbon$group <- consecutive_id(df_ribbon$trend)\ndf_ribbon <- head(do.call(rbind, by(df_ribbon, df_ribbon$group, rbind, NA)), -1)\ndf_ribbon[, c(\"trend\", \"group\")] <- lapply(df_ribbon[, c(\"trend\", \"group\")], na.locf)\ndf_ribbon[] <- lapply(df_ribbon, na.locf, fromLast = T)\n\ncols <- c(\n  \"green\" = \"#169873\",\n  \"yellow\" = \"#DFDF11\",\n  \"orange\" = \"#FFA200\",\n  \"red\" = \"#F2545B\",\n  \"purple\" = \"#5328FF\"\n)\nlabs <- c(\n  \"green\" = \"Declining\",\n  \"yellow\" = \"Likely declining\",\n  \"orange\" = \"Uncertain trend or stable\",\n  \"red\" = \"Likely growing\",\n  \"purple\" = \"Growing\"\n)\n\nepi_plot <- ggplot(df, aes(x = dates, y = I)) +\n  geom_bar(stat = \"identity\", fill = \"#AED2FF\") +\n  scale_x_date(limits = c(min(df$dates) - 1, max(df$dates) + 1), expand = c(0, 0)) +\n  scale_y_continuous(expand = c(0, 0)) +\n  labs(x = NULL, y = \"Incidence\") +\n  theme_classic()\n\nrt_plot <- ggplot() +\n  geom_hline(yintercept = 1,\n             alpha = 0.5,\n             linetype = \"dashed\") +\n  geom_ribbon(\n    aes(\n      x = dates,\n      ymin = quantile_0_025_r,\n      ymax = quantile_0_975_r,\n      fill = trend,\n      group = group\n    ),\n    data = df_ribbon,\n    alpha = 0.3\n  ) +\n  geom_line(aes(\n    x = dates,\n    y = mean_r,\n    color = trend,\n    group = 1\n  ), data = df_line) +\n  scale_x_date(limits = c(min(df$dates) - 1, max(df$dates) + 1), expand = c(0, 0)) +\n  scale_color_manual(\n    values = cols,\n    labels = labs,\n    guide = guide_legend(nrow = 2, byrow = TRUE)\n  ) +\n  scale_fill_manual(\n    values = cols,\n    labels = labs,\n    guide = guide_legend(nrow = 2, byrow = TRUE)\n  ) +\n  labs(\n    x = \"Date of onset\",\n    y = expression(R[t]),\n    color = \"Trend\",\n    fill = \"Trend\"\n  ) +\n  theme_classic() +\n  theme(legend.position = \"bottom\")\n\nplot_grid(epi_plot, rt_plot, nrow = 2, align = \"v\", rel_heights = c(0.4, 0.7))\n```\n\n::: {.cell-output-display}\n![](rt-prac_files/figure-html/unnamed-chunk-3-1.svg){width=100%}\n:::\n:::\n",
    "supporting": [
      "rt-prac_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}