{
  "hash": "795db8fe6fdf15110b8543c9b1e4164c",
  "result": {
    "engine": "knitr",
    "markdown": "# SIR\n\n## Model\n\n![](img/det/sir.svg)\n\n$$\\frac{dS}{dt} = -\\beta SI = -\\lambda S$$ {#eq-sir-ds}\n\n$$\\frac{dI}{dt} = \\beta SI - \\gamma I = \\lambda S - \\gamma I$$ {#eq-sir-di}\n\n$$\\frac{dR}{dt} = \\gamma I$$ {#eq-sir-dr}\n\n-   $\\beta$: effective contact rate.\n-   $\\gamma$: removal rate.\n-   $\\beta I = \\lambda$: the rate from S to I is called **force of infection**.\n\n## Assumptions\n\n-   Each member of a population is either susceptible, infectious, or recovered [@vandendriessche2017].\n-   The disease spreads through direct contact between susceptible and infected individuals.\n-   Well-mixed population, or homogeneous mixing (represented by a single effective contact rate $\\beta$) [@becker2017].\n-   In the most basic form it considers a \"closed population\" without demographics (no births, deaths, or migration) [@keeling2011], make sense when the disease is short lived compared with the population lifetime [@vandendriessche2017].\n-   There is no latent period, individuals become infectious immediately upon contracting the disease.\n-   The effective contact rate $\\beta$ and recovery rate $\\gamma$ are constant over time.\n-   Infectious disease properties are for a single pathogen [@becker2017].\n-   Recovered individuals gain lifelong immunity.\n\n## Density or frequency-dependent\n\n![](img/mod/density-frequency.webp)\n\n> Source: Density-dependent vs. Frequency-dependent Disease Transmission - [Parasite Ecology](https://parasiteecology.wordpress.com/2013/10/17/density-dependent-vs-frequency-dependent-disease-transmission/).\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n**Density-dependent**\n\n$$\\frac{dS}{dt} = -\\beta SI$$\n\n- The unit of $\\beta$ is $\\frac{1}{\\text{time} \\times \\text{people}}$.\n- Transmission increases as density increases.\n- Aerosol contacts (COVID-19).\n\n:::\n\n::: {.column width=\"50%\"}\n\n**Frequency-dependent**\n\n$$\\frac{dS}{dt} = -\\beta S \\frac{I}{N}$$\n\n- The unit of $\\beta$ is $\\frac{1}{\\text{time}}$.\n- Transmission does not increase as density increases.\n- Sexually-transmitted diseases.\n\n:::\n\n::::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(odin)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(RColorBrewer)\nlibrary(patchwork)\n```\n:::\n\n\nBelow is how we numerically solve the differential equations @eq-sir-ds, @eq-sir-di, @eq-sir-dr in R with the `odin` package.\n\n::: {#lst-sir-det}\n\n::: {.cell}\n\n```{.r .cell-code}\nodin_sir <- odin::odin({\n  # Derivatives\n  deriv(S) <- -beta * S * I\n  deriv(I) <- beta * S * I - gamma * I\n  deriv(R) <- gamma * I\n  deriv(CInc) <- beta * S * I\n  \n  # Initial conditions\n  initial(S) <- S_init\n  initial(I) <- I_init\n  initial(R) <- R_init\n  initial(CInc) <- CInc_init\n  \n  # Parameters and initial values\n  beta <- user(0.004)\n  gamma <- user(0.5)\n  S_init <- user(999)\n  I_init <- user(1)\n  R_init <- user(0)\n  CInc_init <- user(0)\n})\n\nsir_mod <- function(beta, gamma, S0, I0, R0, times) {\n  # Set values for a new run\n  odin_run <- odin_sir$new(beta = beta, gamma = gamma, S_init = S0, I_init = I0, R_init = R0)\n  \n  # Run the model\n  out <- data.frame(odin_run$run(times))\n\n  # Compute incidence from cumulative incidence\n  out$Inc <- c(I0, diff(out$CInc))\n  out$CInc <- NULL\n  out\n}\n```\n:::\n\n\nDeterministic SIR model\n:::\n\n## Incidence or prevalence\n\n::: callout-important\nBe careful of what kind of data we are using to fit the model:\n\n-   **Incidence**: use the $\\beta SI$ part.\n\n$$\\text{Incidence} = \\frac{\\text{Number of new cases during a period}}{\\text{Population at risk during the same period}}$$\n\n-   **Prevalence**: use the **I compartment**.\n\n$$\\text{Prevalence} = \\frac{\\text{Number of existing cases at time t}}{\\text{Total population at time t}}$$\n:::\n\nThere are two ways to compute incidence.\n\n1.  While writing the differential equations, we tell `odin` to compute the cumulative incidence, then compute the incidence by using `diff()` on the cumulative incidence.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cumulative incidence\nderiv(CInc) <- beta * S * I\n# Compute incidence from cumulative incidence\nout$Inc <- c(I0, diff(out$CInc))\n```\n:::\n\n\n2.  In this \"closed population\", the incidence is the number of individuals moving out of $S$ in each time step. So we can compute it from the $S$ column. Let compare it with the previous method.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred <- sir_mod(beta = 0.004, gamma = 0.5, S0 = 999, I0 = 1, R0 = 0, times = 0:13)\n\ntmp <- pred\ntmp$Inc2 <- c(tmp$I[1], -diff(tmp$S))\ntmp[,\"Inc-Inc2\"] <- round(tmp$Inc - tmp$Inc2)\ntmp[,c(\"Inc\", \"Inc2\", \"Inc-Inc2\")]\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Inc\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Inc2\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Inc-Inc2\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1.000000e+00\",\"2\":\"1.000000e+00\",\"3\":\"0\"},{\"1\":\"3.529431e+01\",\"2\":\"3.529431e+01\",\"3\":\"0\"},{\"1\":\"5.021367e+02\",\"2\":\"5.021367e+02\",\"3\":\"0\"},{\"1\":\"4.154123e+02\",\"2\":\"4.154123e+02\",\"3\":\"0\"},{\"1\":\"3.912073e+01\",\"2\":\"3.912073e+01\",\"3\":\"0\"},{\"1\":\"4.887000e+00\",\"2\":\"4.887000e+00\",\"3\":\"0\"},{\"1\":\"1.109860e+00\",\"2\":\"1.109860e+00\",\"3\":\"0\"},{\"1\":\"3.716889e-01\",\"2\":\"3.716889e-01\",\"3\":\"0\"},{\"1\":\"1.575463e-01\",\"2\":\"1.575463e-01\",\"3\":\"0\"},{\"1\":\"7.697212e-02\",\"2\":\"7.697212e-02\",\"3\":\"0\"},{\"1\":\"4.097450e-02\",\"2\":\"4.097450e-02\",\"3\":\"0\"},{\"1\":\"2.297365e-02\",\"2\":\"2.297365e-02\",\"3\":\"0\"},{\"1\":\"1.329223e-02\",\"2\":\"1.329223e-02\",\"3\":\"0\"},{\"1\":\"7.838806e-03\",\"2\":\"7.838806e-03\",\"3\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nNow let have a look at the output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(pred)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"t\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"S\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"I\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"R\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Inc\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"999.000000\",\"3\":\"1.0000\",\"4\":\"0.000000\",\"5\":\"1.00000\",\"_rn_\":\"1\"},{\"1\":\"1\",\"2\":\"963.705688\",\"3\":\"31.7982\",\"4\":\"4.496109\",\"5\":\"35.29431\",\"_rn_\":\"2\"},{\"1\":\"2\",\"2\":\"461.568981\",\"3\":\"441.9156\",\"4\":\"96.515457\",\"5\":\"502.13671\",\"_rn_\":\"3\"},{\"1\":\"3\",\"2\":\"46.156695\",\"3\":\"569.5040\",\"4\":\"384.339263\",\"5\":\"415.41229\",\"_rn_\":\"4\"},{\"1\":\"4\",\"2\":\"7.035962\",\"3\":\"373.4984\",\"4\":\"619.465611\",\"5\":\"39.12073\",\"_rn_\":\"5\"},{\"1\":\"5\",\"2\":\"2.148961\",\"3\":\"230.1295\",\"4\":\"767.721585\",\"5\":\"4.88700\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndf_plot <- pivot_longer(pred, cols = S:Inc, names_to = \"comp\", values_to = \"n\")\n\nggplot(df_plot, aes(x = t, y = n, color = comp)) +\n  geom_line(linewidth = 1.2) +\n  scale_color_brewer(palette = \"PuOr\", breaks = c(\"S\", \"Inc\", \"I\", \"R\")) +\n  labs(color = NULL, y = NULL, x = \"Time\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](sir-det_files/figure-html/unnamed-chunk-6-1.svg){width=100%}\n:::\n:::\n\n\nThe time to peak of incidence is earlier than prevalence:\n\n-   Incidence reflects the immediate rate of new infections, the peak of incidence is reached when the transmission rate begins to decline.\n-   Prevalence accumulates both new and existing cases. Even after the incidence starts to decline, the active cases who were infected before the incidence peak are still there waiting for recovering. Prevalence only starts to decline when the recovery rate surpasses the rate of new infections significantly.\n\n::: callout-important\n\nNormally, public health officials are interested in the **incidence** in the general population (to track disease spread) and the **prevalence** in intensive care units (to ensure it does not exceed ICU bed capacity).\n\n:::\n\n## Sensitivity analysis\n\nThe effective contact rate $\\beta$ and the recovery rate $\\gamma$ both affect whether or not there is an epidemic. The total number of people in the population and the initial number of infected people have no effect on whether there is an epidemic.\n\nBelow is a function that take a range of values of parameters and compare the model outputs.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsir_sa <- function(vals, parm, outcome, times, init_beta = 0.004, init_gamma = 0.5) {\n  pick_comp <- ifelse(outcome == \"prev\", \"I\", \"Inc\")\n  plot_lab <- ifelse(outcome == \"prev\", \"Prevalence\", \"Incidence\")\n  symb <- ifelse(parm == \"beta\", \"\\u03b2\", \"\\u03b3\")\n  l <- list()\n  for(i in 1:length(vals)) {\n    if (parm == \"beta\") {\n      pred <- sir_mod(beta = vals[i], gamma = init_gamma, S0 = 999, I0 = 1, R0 = 0, times = times)[, c(\"t\", pick_comp)]\n    } else {\n      pred <- sir_mod(beta = init_beta, gamma = vals[i], S0 = 999, I0 = 1, R0 = 0, times = times)[, c(\"t\", pick_comp)]\n    }\n    pred$comp <- paste0(pick_comp, i)\n    colnames(pred) <- c(\"t\", \"n\", \"comp\")\n    l[[i]] <- pred\n  }\n  # Bind this list into a data frame\n  df_plot <- Reduce(rbind, l)\n  # Set level I1 < I2 < I3... according to the increase of beta values\n  df_plot$comp <- factor(df_plot$comp, levels = c(paste0(pick_comp, 1:length(vals))))\n  \n  # Plot results\n  my_palette <- brewer.pal(9, \"Blues\")[(9-length(vals)+1):9]\n  \n  ggplot(df_plot, aes(x = t, y = n, color = comp)) + \n    geom_line(linewidth = 1.2) +\n    scale_color_manual(values = my_palette, labels = c(paste0(symb, \" = \", vals))) +\n    labs(color = NULL, y = plot_lab, x = \"Time\") +\n    theme_minimal()\n}\n```\n:::\n\n\n### Effective contact rate $\\beta$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nvals <- seq(0.001, 0.006, 0.001)\n\np1 <- sir_sa(vals = vals, parm = \"beta\", outcome = \"prev\", times = 0:13) + labs(x = NULL)\np2 <- sir_sa(vals = vals, parm = \"beta\", outcome = \"inc\", times = 0:13)\n\np1 / p2 + plot_layout(guides = \"collect\") & theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](sir-det_files/figure-html/unnamed-chunk-8-1.svg){width=100%}\n:::\n:::\n\n\nWhen $\\beta$ **decreases**, less susceptible individuals become infected per unit time:\n\n-   Time until peak ***increases***: because the speed of susceptible individuals become infected is slower.\n-   Epidemic duration ***increases***: the rate of new infections slows down so it can lead to a longer epidemic period, but depends on the balance between the infection rate and the recovery rate.\n-   Outbreak size **decreases**: $R_0 = \\frac{\\beta}{\\gamma}$, so if $\\beta$ decreases, $R_0$ **decreases**, each infected individual infect less people on average.\n-   **Lower** epidemic peak: because fewer infections occurring simultaneously.\n\nInterventions that decrease $\\beta$ cause a lower outbreak size and a lower epidemic peak. This effect is often referred to as **\"flattening the curve\"**.\n\n### Recovery rate $\\gamma$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nvals <- seq(0.3, 0.8, 0.1)\n\np1 <- sir_sa(vals = vals, parm = \"gamma\", outcome = \"prev\", times = 0:13) + labs(x = NULL)\np2 <- sir_sa(vals = vals, parm = \"gamma\", outcome = \"inc\", times = 0:13)\n\np1 / p2 + plot_layout(guides = \"collect\") & theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](sir-det_files/figure-html/unnamed-chunk-9-1.svg){width=100%}\n:::\n:::\n\n\nWhen $\\gamma$ **decreases**, patients recover more slowly:\n\n-   Outbreak size ***increases***: patients remain infectious for a longer period; since $R_0 = \\frac{\\beta}{\\gamma}$, a decrease in $\\gamma$ leads to an increase in $R_0$, meaning each infected individual infects less people on average.\n-   ***Higher*** epidemic peak: with a higher $R_0$ more individuals are infected after each generation.\n-   Time until peak ***may increases***: the infected population takes longer to clear out due to slower recovery, but the exact timing of the peak also depends on the balance between infection and recovery rates.\n-   Epidemic duration ***slightly increases***: for same reason as the peak time, the overall duration of the epidemic is prolonged due to slower recovery rates.\n\n## Corollaries\n\n### The threshold phenomenon\n\nFrom @eq-sir-di:\n\n$$\\frac{dI}{dt} = \\beta SI - \\gamma I = I(\\beta S - \\gamma)$$\n\nThe infection \"dies out\" when:\n\n$$\\frac{dI}{dt} < 0 \\Leftrightarrow \\beta S - \\gamma < 0 \\Leftrightarrow S < \\frac{\\gamma}{\\beta}$$\n\n> The proportion of susceptibles in the population must exceed this critical threshold $\\frac{\\gamma}{\\beta}$ for an infection to invade [@keeling2011].\n\nThe inverse of the relative removal rate is called the basic reproductive ratio $R_0 = \\frac{\\beta}{\\gamma}$ [@keeling2011]. See @def-r0 for more details.\n\n### Epidemic burnout\n\nDivide @eq-sir-ds by @eq-sir-dr:\n\n$$\\frac{dS}{dR} = \\frac{-\\beta S I}{\\gamma I} = -\\frac{\\beta}{\\gamma} S$$\n\nUpon integrating with respect to R, we obtain:\n\n$$S(t) = S(0)e^{-\\frac{\\beta}{\\gamma} R(t)}$$\n\nGiven that $e^x > 0 \\quad \\forall x$, therefore $S(t) > 0$ there will always be some susceptibles in the population who escape infection, leading to an important counter-intuitive conclusion from this model:\n\n> The chain of transmission eventually breaks due to the decline in infectives, not due to a complete lack of susceptibles [@keeling2011].\n",
    "supporting": [
      "sir-det_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}