{
  "hash": "d59cd6b1ff7b6c56504853edab7a23f5",
  "result": {
    "engine": "knitr",
    "markdown": "# SIR\n\n## Assumptions\n\n-   The disease spreads through direct contact between susceptible and infected individuals.\n-   Well-mixed population, or homogeneous mixing (a single contact rate $\\beta$) [@becker2017].\n-   In the most basic form it considers a \"closed population\" without demographics (no births, deaths, or migration) [@keeling2011].\n-   Infectious disease properties are for a single pathogen [@becker2017].\n-   Recovered individuals gain lifelong immunity.\n\n## Model\n\n$$\\frac{dS}{dt} = -\\beta SI = -\\lambda S$$ {#eq-sir-ds}\n\n$$\\frac{dI}{dt} = \\beta SI - \\gamma I = \\lambda S - \\gamma I$$ {#eq-sir-di}\n\n$$\\frac{dR}{dt} = \\gamma I$$ {#eq-sir-dr}\n\n-   $\\beta$: effective contact rate.\n-   $\\gamma$: removal rate.\n-   $\\beta I = \\lambda$: the rate from S to I is called **force of infection**.\n\n## Code\n\n### Model\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(deSolve)\nlibrary(tidyr)\nlibrary(bbmle)\nlibrary(ggplot2)\nlibrary(RColorBrewer)\nlibrary(patchwork)\n```\n:::\n\n\nWrite a function based on @eq-sir-ds, @eq-sir-di and @eq-sir-dr\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# sir_mod() returns a data frame consists S, I, R, Inc values by time\nsir_mod <- function(beta, gamma, S0, I0, R0, times) {\n  \n  sir_equations <- function(time, variables, parameters) {\n    with(as.list(c(variables, parameters)), {\n      dS <- -beta * S * I\n      dI <-  beta * S * I - gamma * I\n      dR <-  gamma * I\n      return(list(c(dS, dI, dR)))\n    })\n  }\n  \n  parameters_values <- c(beta = beta, gamma = gamma)\n  initial_values <- c(S = S0, I = I0, R = R0)\n  \n  out <- ode(initial_values, times, sir_equations, parameters_values)\n\n  out <- as.data.frame(out)\n  # Compute incidence\n  out$Inc <- c(0, -diff(out$S))\n  out\n}\n```\n:::\n\n\n::: {.callout-important}\nNote that after running the SIR model, we need to compute incidence separately. When fitting real data:\n\n-   **Incidence**: new cases are individuals moving out of S.\n-   **Prevalence**: use the **I compartment**.\n:::\n\n$$\\text{Incidence} = \\frac{\\text{Number of new cases during a period}}{\\text{Population at risk during the same period}}$$\n\n$$\\text{Prevalence} = \\frac{\\text{Number of existing cases at time t}}{\\text{Total population at time t}}$$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npred <- sir_mod(beta = 0.004, gamma = 0.5, S0 = 999, I0 = 1, R0 = 0, times = 0:13)\n\ndf_plot <- pivot_longer(pred, cols = S:Inc, names_to = \"comp\", values_to = \"n\")\n\nggplot(df_plot, aes(x = time, y = n, color = comp)) +\n  geom_point() + geom_line() +\n  scale_color_brewer(palette = \"PuOr\", breaks = c(\"S\", \"Inc\", \"I\", \"R\")) +\n  labs(color = NULL, y = NULL) +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](sir-det_files/figure-html/unnamed-chunk-3-1.svg){width=100%}\n:::\n:::\n\n\nThe time to peak of incidence is earlier than prevalence:\n\n- Incidence reflects the immediate rate of new infections, the peak of incidence is reached when the transmission rate begins to decline.\n- Prevalence accumulates both new and existing cases. Even after the incidence starts to decline, the active cases who were infected before the incidence peak are still there waiting for recovering. Prevalence only starts to decline when the recovery rate surpasses the rate of new infections significantly.\n\n## Sensitivity analysis\n\nThe effective contact rate $\\beta$ and the recovery rate $\\gamma$ both affect whether or not there is an epidemic. The total number of people in the population and the initial number of infected people have no effect on whether there is an epidemic.\n\nBelow is a function that take a range of values of parameters and compare the model outputs.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsir_sa <- function(vals, parm, outcome, times, init_beta = 0.004, init_gamma = 0.5) {\n  pick_comp <- ifelse(outcome == \"prev\", \"I\", \"Inc\")\n  plot_lab <- ifelse(outcome == \"prev\", \"prevalence\", \"incidence\")\n  symb <- ifelse(parm == \"beta\", \"\\u03b2\", \"\\u03b3\")\n  l <- list()\n  for(i in 1:length(vals)) {\n    if (parm == \"beta\") {\n      pred <- sir_mod(beta = vals[i], gamma = init_gamma, S0 = 999, I0 = 1, R0 = 0, times = times)[, c(\"time\", pick_comp)]\n    } else {\n      pred <- sir_mod(beta = init_beta, gamma = vals[i], S0 = 999, I0 = 1, R0 = 0, times = times)[, c(\"time\", pick_comp)]\n    }\n    pred$comp <- paste0(pick_comp, i)\n    colnames(pred) <- c(\"time\", \"n\", \"comp\")\n    l[[i]] <- pred\n  }\n  # Bind this list into a data frame\n  df_plot <- Reduce(rbind, l)\n  # Set level I1 < I2 < I3... according to the increase of beta values\n  df_plot$comp <- factor(df_plot$comp, levels = c(paste0(pick_comp, 1:length(vals))))\n  \n  # Plot results\n  my_palette <- brewer.pal(9, \"Blues\")[(9-length(vals)+1):9]\n  \n  ggplot(df_plot, aes(x = time, y = n, color = comp)) + \n    geom_point() + geom_line() +\n    scale_color_manual(values = my_palette, labels = c(paste0(symb, \" = \", vals))) +\n    labs(color = NULL, y = plot_lab) +\n    theme_minimal()\n}\n```\n:::\n\n\n### Effective contact rate $\\beta$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nvals <- seq(0.001, 0.006, 0.001)\n\np1 <- sir_sa(vals = vals, parm = \"beta\", outcome = \"prev\", times = 0:13) + labs(x = NULL)\np2 <- sir_sa(vals = vals, parm = \"beta\", outcome = \"inc\", times = 0:13)\n\np1 / p2 + plot_layout(guides = \"collect\") & theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](sir-det_files/figure-html/unnamed-chunk-5-1.svg){width=100%}\n:::\n:::\n\n\nWhen $\\beta$ **increases**, more susceptible individuals become infected per unit time:\n\n- Outbreak size **increases**: $R_0 = \\frac{\\beta}{\\gamma}$, so if $\\beta$ increases, $R_0$ **increases**, each infected individual infect more people on average.\n- **Larger** epidemic peak: the peak number at any given time will be higher, because more susceptible individuals are infected.\n- Time until peak ***decreases***: because the speed of susceptible individuals become infected is faster.\n- Epidemic duration ***decreases***: because the pool of susceptible individuals depletes quickly, the epidemic may conclude sooner when there are few susceptible individuals left.\n\n### Recovery rate $\\gamma$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nvals <- seq(0.3, 0.8, 0.1)\n\np1 <- sir_sa(vals = vals, parm = \"gamma\", outcome = \"prev\", times = 0:13) + labs(x = NULL)\np2 <- sir_sa(vals = vals, parm = \"gamma\", outcome = \"inc\", times = 0:13)\n\np1 / p2 + plot_layout(guides = \"collect\") & theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](sir-det_files/figure-html/unnamed-chunk-6-1.svg){width=100%}\n:::\n:::\n\n\nWhen $\\gamma$ **increases**, patients recover with a faster speed:\n\n- Outbreak size ***decreases***: patients have ***less time to infect*** susceptible individuals; and also $R_0 = \\frac{\\beta}{\\gamma}$, so if $\\gamma$ increases, $R_0$ ***decreases***, each infected individual infect less people on average.\n- ***Smaller*** epidemic peak: the peak number of infected individuals will be lower because $R_0$ ***decreases***.\n- Time until peak ***slightly decreases***: because the infected population clears out faster, but this depends on the balance between the faster recovery and the rate of new infections.\n- Epidemic duration ***slightly decreases***: for same reason as the peak time.\n\n## Corollaries\n\n### The threshold phenomenon\n\nFrom @eq-sir-di:\n\n$$\\frac{dI}{dt} = \\beta SI - \\gamma I = I(\\beta S - \\gamma)$$\n\nThe infection \"dies out\" when:\n\n$$\\frac{dI}{dt} < 0 \\Leftrightarrow \\beta S - \\gamma < 0 \\Leftrightarrow S < \\frac{\\gamma}{\\beta}$$\n\n### Epidemic burnout\n\nDivide @eq-sir-ds by @eq-sir-dr:\n\n$$\\frac{dS}{dR} = \\frac{-\\beta S I}{\\gamma I} = -\\frac{\\beta}{\\gamma} S$$\n\nUpon integrating with respect to R, we obtain:\n\n$$S(t) = S(0)e^{-\\frac{\\beta}{\\gamma} R(t)}$$\n\nGiven that $e^x > 0 \\quad \\forall x$, therefore $S(t) > 0$ there will always be some susceptibles in the population who escape infection, leading to an important counter-intuitive conclusion from this model:\n\n> The chain of transmission eventually breaks due to the decline in infectives, not due to a complete lack of susceptibles.\n",
    "supporting": [
      "sir-det_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}