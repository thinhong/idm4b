{
  "hash": "66127f195ff8de9123631bcd649fde2d",
  "result": {
    "engine": "knitr",
    "markdown": "# SEIR\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(odin)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(RColorBrewer)\nlibrary(patchwork)\n```\n:::\n\n\nLet reuse the deterministic SIR model code from @lst-sir-det and write code for the deterministic SEIR model.\n\n\n::: {.cell}\n\n:::\n\n\n::: {#lst-seir-det}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nodin_seir <- odin::odin({\n  # Derivatives\n  deriv(S) <- -beta * S * I\n  deriv(E) <- beta * S * I - sigma * E\n  deriv(I) <- sigma * E - gamma * I\n  deriv(R) <- gamma * I\n  deriv(CInc) <- sigma * E\n  \n  # Initial conditions\n  initial(S) <- S_init\n  initial(E) <- E_init\n  initial(I) <- I_init\n  initial(R) <- R_init\n  initial(CInc) <- CInc_init\n  \n  # Parameters and initial values\n  beta <- user(0.004)\n  sigma <- user(0.5)\n  gamma <- user(0.5)\n  S_init <- user(369)\n  E_init <- user(0)\n  I_init <- user(1)\n  R_init <- user(0)\n  CInc_init <- user(0)\n})\n\nseir_mod <- function(beta, sigma, gamma, S0, E0, I0, R0, times) {\n  # Set values for a new run\n  odin_run <- odin_seir$new(beta = beta, sigma = sigma, gamma = gamma, S_init = S0, E_init = E0, I_init = I0, R_init = R0)\n  \n  # Run the model\n  out <- data.frame(odin_run$run(times))\n\n  # Compute incidence from cumulative incidence\n  out$Inc <- c(I0, diff(out$CInc))\n  out$CInc <- NULL\n  out\n}\n```\n:::\n\n\nDeterministic SEIR model\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npred1 <- sir_mod(beta = 0.004, gamma = 0.5, S0 = 999, I0 = 1, R0 = 0, times = 1:20)\npred2 <- seir_mod(beta = 0.004, sigma = 0.5, gamma = 0.5, S0 = 999, E0 = 0, I0 = 1, R0 = 0, times = 1:20)\n\ndf_plot <- pivot_longer(pred1, cols = S:Inc, names_to = \"comp\", values_to = \"n\")\n\nmy_palette <- brewer.pal(11, \"PuOr\")[c(10, 4, 3, 8)]\n\np1 <- ggplot(df_plot, aes(x = t, y = n, color = comp)) +\n  geom_line(linewidth = 1.2) +\n  scale_color_manual(values = my_palette, breaks = c(\"S\", \"Inc\", \"I\", \"R\")) +\n  labs(color = NULL, y = NULL, x = NULL) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\ndf_plot <- pivot_longer(pred2, cols = S:Inc, names_to = \"comp\", values_to = \"n\")\n\nmy_palette <- brewer.pal(11, \"PuOr\")[c(10, 1, 4, 3, 8)]\n\np2 <- ggplot(df_plot, aes(x = t, y = n, color = comp)) +\n  geom_line(linewidth = 1.2) +\n  scale_color_manual(values = my_palette, breaks = c(\"S\", \"E\", \"Inc\", \"I\", \"R\")) +\n  labs(color = NULL, y = NULL, x = \"Time\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n\np1 / p2\n```\n\n::: {.cell-output-display}\n![](seir-det_files/figure-html/unnamed-chunk-4-1.svg){width=100%}\n:::\n:::\n",
    "supporting": [
      "seir-det_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}