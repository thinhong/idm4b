{
  "hash": "edc11d5eb49633a014563ea87ebd1750",
  "result": {
    "engine": "knitr",
    "markdown": "# Model vaccination\n\n::: {.callout-note appearance=\"simple\"}\n# Acknowledgement\n\nThis chapter is based on the teachings of my PhD supervisor, Dr. Marc Choisy, and a lecture given by Asst Prof. Hannah Clapham at MIDSEA Summer School 2024, for which I am deeply grateful.\n:::\n\nTo model vaccination, we need to decide 2 things:\n\n1. What is the vaccine effect? Does it protect against infection, severe disease, transmission, or a combination?\n\n2. How do we model the vaccine effectiveness?\n\n## Vaccine effects\n\n### Prevent infection\n\nVaccine prevents the pathogen from establishing an infection in the body. A vaccinated person is less likely to get infected.\n\n![](img/vax/prv-inf.svg)\n\nAssuming a perfect vaccine against infection, the model can be designed like this:\n\n![](img/vax/prv-inf-mod.svg)\n\nVaccinated people $V$ remain uninfected in their lifetime and do not participate in disease transmission.\n\n### Prevent severe disease\n\nVaccine reduces the severity of the disease if the vaccinated person does get infected. A vaccinated individual still get infected but experiences a much milder form of the disease.\n\n![](img/vax/prv-dis.svg)\n\n### Prevent transmission\n\nVaccine reduces the ability of a vaccinated individual, who becomes infected, to transmit the pathogen to others. A vaccinated person still get infected, still get sick, but they are less likely to spread the disease to others.\n\n![](img/vax/prv-trans.svg)\n\nAssuming a perfect vaccine against transmission, the model can be designed like this:\n\n![](img/vax/prv-trans-mod.svg)\n\n$I$ being the only source of infection that contributes to the force of infection. Vaccinated people $S_v$ still get infected and become $I_v$, but they do not transmit the disease.\n\n### Mixed effects\n\nThe effect of imperfect vaccines is often a mix of the three.\n\n![](img/vax/prv-mix.svg)\n\n## Imperfect protections\n\nWhat is meant by a vaccine with effectiveness of 80% protection against a specific clinical endpoint? The mechanism of vaccine action is typically modelled in two ways:\n\n### All-or-nothing model\n\n::: {.callout-tip appearance=\"simple\"}\n**All-or-nothing** (AoN, also called the **polarized** [@park2023], or **take**) model assumes that **among vaccinated** individuals, a **proportion** $VE_P$ are **completely protected**, while **the remaining fraction** $1 - VE_P$ remains **completely unprotected** [@zachreson2023; @park2023].\n:::\n\nAn effectiveness of 80% here implies that among vaccinated people, 80% are completely protected, and 20% receive no protection [@worldhealthorganization2013].\n\n![](img/vax/aon.svg)\n\nAssumming a standard SIR model, vaccine protects against **infection** with vaccine effectiveness $VE_P$, $\\rho$ represents the vaccination rate:\n\n-   Among the susceptible $S$, $\\rho S$ are vaccinated.\n-   Among those $\\rho S$ who are vaccinated, $\\rho VE_P S$ are completely protected and go directly to $R_v$, the remaining is $\\rho (1 - VE_P) S$.\n-   The remaining $\\rho (1 - VE_P) S$ are completely unprotected, and will be infected with force of infection $\\lambda(t)$ just like those who are unvaccinated.\n\n![All-or-nothing vaccination model [@park2023]](img/vax/aon-mod.svg){#fig-aon-mod}\n\n$$\\begin{align}\n\\frac{dS}{dt} &= -\\lambda(t) S - \\rho S \\\\\n\\frac{dI}{dt} &= \\lambda(t) S - \\gamma I \\\\\n\\frac{dR}{dt} &= \\gamma I \\\\\n\\frac{dS_v}{dt} &= \\rho (1 - VE_P) S - \\lambda(t) S_v \\\\\n\\frac{dI_v}{dt} &= \\lambda(t) S_v - \\gamma I_v \\\\\n\\frac{dR_v}{dt} &= \\rho VE_P S + \\gamma I_v\n\\end{align}$$\n\n### Leaky model\n\n::: {.callout-tip appearance=\"simple\"}\n**Leaky** (or **degree**) model assumes that **all vaccinated** individuals **are partially protected** [@zachreson2023].\n:::\n\nAn effectiveness of 80% here implies that all vaccinated people have the endpoint of interest reduced by 80% compared to non-vaccinees.\n\n![](img/vax/leaky.svg)\n\nThe assumption that no vaccinated people is totally or permanently protected implies one or both of the following [@worldhealthorganization2013]:\n\n-   No amount (titre) of the immune marker is totally protective or, if it is, no individual can maintain that titre for a long period (because of waning or transient immunosuppression)\n-   The degree of protection is a function of the level of the immune marker - the simplest explanation being that protection is a function of both the level of the immune marker and the challenge dose.\n\nAssumming a standard SIR model, vaccine protects against **infection** with vaccine effectiveness $VE_L$, $\\rho$ represents the vaccination rate.\n\n-   Among susceptible $S$, $\\rho S$ are vaccinated.\n-   Among those $\\rho S$ who are vaccinated, force of infection $\\lambda(t)$ is reduced by a factor of $1 - VE_L$.\n\n![Leaky vaccination model [@park2023]](img/vax/leaky-mod.svg){#fig-leaky-mod}\n\n$$\\begin{align}\n\\frac{dS}{dt} &= -\\lambda(t) S - \\rho S \\\\\n\\frac{dI}{dt} &= \\lambda(t) S - \\gamma I \\\\\n\\frac{dR}{dt} &= \\gamma I \\\\\n\\frac{dS_v}{dt} &= \\rho S - (1 - VE_L) \\lambda(t) S_v \\\\\n\\frac{dI_v}{dt} &= (1 - VE_L) \\lambda(t) S_v - \\gamma I_v \\\\\n\\frac{dR_v}{dt} &= \\gamma I_v\n\\end{align}$$\n\n## Multiple doses\n\nSome vaccines require multiple doses, like measles (2 doses) or rotavirus (2 doses), with varying effectiveness per dose. Below is the DynaMICE model [@verguet2015] for the 2-dose measles vaccine, assuming AoN effectiveness as in @fig-aon-mod for both doses.\n\n![](img/vax/dynamice.svg)\n\n## Code\n\n### A perfect vaccine against infection\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(odin)\nlibrary(tidyr)\nlibrary(ggplot2)\n```\n:::\n\n\n![](img/vax/prv-inf-mod.svg)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npfvac_ode <- odin({\n  # Derivatives\n  deriv(S) <- -beta * S * I - rho * S\n  deriv(I) <- beta * S * I - gamma * I\n  deriv(R) <- gamma * I\n  deriv(V) <- rho * S\n  \n  # Initial conditions\n  initial(S) <- N_init - I_init\n  initial(I) <- I_init\n  initial(R) <- R_init\n  initial(V) <- V_init\n  \n  # Parameters and initial values\n  beta <- user(8.77e-8)\n  gamma <- user(0.2)\n  rho <- user(0.005)\n  N_init <- user(5700000)\n  I_init <- user(1)\n  R_init <- user(0)\n  V_init <- user(0)\n})\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Initialize model\npfvac_mod <- pfvac_ode$new()\n# How long to run\ntimes <- seq(0,300)\n# Run the model\npred <- data.frame(pfvac_mod$run(times))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndf_plot <- pivot_longer(pred, cols = S:V, names_to = \"comp\", values_to = \"n\")\n\nggplot(df_plot, aes(x = t, y = n, color = comp)) +\n  geom_line(linewidth = 1.2) +\n  scale_color_brewer(palette = \"PuOr\", breaks = c(\"S\", \"I\", \"R\", \"V\")) +\n  labs(color = NULL, y = NULL, x = \"Time\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](vax-mod_files/figure-html/unnamed-chunk-4-1.svg){width=100%}\n:::\n:::\n\n\n\n### AoN model against infection\n\n\n\n### Leaky model against infection\n\n",
    "supporting": [
      "vax-mod_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}