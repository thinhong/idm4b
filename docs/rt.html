<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Estimating R_t – Infectious disease modelling for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./rt-prac.html" rel="next">
<link href="./r0.html" rel="prev">
<link href="./logo-icon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X391ZN63GG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-X391ZN63GG', { 'anonymize_ip': true});
</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rnum.html">Reproduction number</a></li><li class="breadcrumb-item"><a href="./rt.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Infectious disease modelling for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modelling</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./det.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deterministic models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sir-det.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">SIR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./seir-det.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">SEIR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./het-det.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Heterogeneities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tsir.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">tsiR</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stochastic models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./seir-sto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">SEIR</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./calib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calibration</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Least squares estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Maximum likelihood estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mcmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MCMC</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Particle filter</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rnum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reproduction number</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gen-int.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Generation interval</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_0\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rt.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rt-prac.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title"><span class="math inline">\(R_t\)</span> in practice</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./intv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interventions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ftc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Flattening the curve</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Vaccination</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vax-perf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Vaccine performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vax-mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Model vaccination</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vax-measles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Measles vaccine</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./he.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Health economics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./he-etr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">EtR Process</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sero.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Serological data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./serocat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Serocatalytic models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Generalized linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Generalized additive model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Survival analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reports</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rp-risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Risk assessment report</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rp-response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Outbreak response report</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dict.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Dictionary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./odin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Odin notes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metaprg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Metaprogramming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./func.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Useful functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simll.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Simulate line list</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#instantaneous-reproduction-number-r_ti" id="toc-instantaneous-reproduction-number-r_ti" class="nav-link active" data-scroll-target="#instantaneous-reproduction-number-r_ti"><span class="header-section-number">12.1</span> Instantaneous reproduction number <span class="math inline">\(R_t^i\)</span></a>
  <ul>
  <li><a href="#exact-calculation" id="toc-exact-calculation" class="nav-link" data-scroll-target="#exact-calculation"><span class="header-section-number">12.1.1</span> Exact calculation</a></li>
  <li><a href="#sec-cori" id="toc-sec-cori" class="nav-link" data-scroll-target="#sec-cori"><span class="header-section-number">12.1.2</span> Cori method</a></li>
  <li><a href="#when-can-we-start-estimating-r_ti" id="toc-when-can-we-start-estimating-r_ti" class="nav-link" data-scroll-target="#when-can-we-start-estimating-r_ti"><span class="header-section-number">12.1.3</span> When can we start estimating <span class="math inline">\(R_t^i\)</span>?</a></li>
  <li><a href="#key-considerations" id="toc-key-considerations" class="nav-link" data-scroll-target="#key-considerations"><span class="header-section-number">12.1.4</span> Key considerations</a></li>
  </ul></li>
  <li><a href="#case-reproduction-number-r_tc" id="toc-case-reproduction-number-r_tc" class="nav-link" data-scroll-target="#case-reproduction-number-r_tc"><span class="header-section-number">12.2</span> Case reproduction number <span class="math inline">\(R_t^c\)</span></a>
  <ul>
  <li><a href="#sec-rt-case-exact" id="toc-sec-rt-case-exact" class="nav-link" data-scroll-target="#sec-rt-case-exact"><span class="header-section-number">12.2.1</span> Exact calculation</a></li>
  <li><a href="#wallinga-and-teunis-method" id="toc-wallinga-and-teunis-method" class="nav-link" data-scroll-target="#wallinga-and-teunis-method"><span class="header-section-number">12.2.2</span> Wallinga and Teunis method</a></li>
  </ul></li>
  <li><a href="#compare-r_ti-and-r_tc" id="toc-compare-r_ti-and-r_tc" class="nav-link" data-scroll-target="#compare-r_ti-and-r_tc"><span class="header-section-number">12.3</span> Compare <span class="math inline">\(R_t^i\)</span> and <span class="math inline">\(R_t^c\)</span></a></li>
  <li><a href="#potential-biases" id="toc-potential-biases" class="nav-link" data-scroll-target="#potential-biases"><span class="header-section-number">12.4</span> Potential biases</a>
  <ul>
  <li><a href="#generation-interval" id="toc-generation-interval" class="nav-link" data-scroll-target="#generation-interval"><span class="header-section-number">12.4.1</span> Generation interval</a></li>
  <li><a href="#delays" id="toc-delays" class="nav-link" data-scroll-target="#delays"><span class="header-section-number">12.4.2</span> Delays</a></li>
  </ul></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code"><span class="header-section-number">12.5</span> Code</a>
  <ul>
  <li><a href="#epiestim" id="toc-epiestim" class="nav-link" data-scroll-target="#epiestim"><span class="header-section-number">12.5.1</span> EpiEstim</a>
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">12.5.1.1</span> </a></li>
  </ul></li>
  <li><a href="#epinow2" id="toc-epinow2" class="nav-link" data-scroll-target="#epinow2"><span class="header-section-number">12.5.2</span> EpiNow2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rnum.html">Reproduction number</a></li><li class="breadcrumb-item"><a href="./rt.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><span class="math inline">\(R_t\)</span> can be defined in 2 ways: as the <strong>instantaneous reproduction number</strong> (see <a href="rnum.html#sec-rt-inst" class="quarto-xref"><span>Section 3.1</span></a>) or as the <strong>case reproduction number</strong> (see <a href="rnum.html#sec-rt-case" class="quarto-xref"><span>Section 3.2</span></a>).</p>
<section id="instantaneous-reproduction-number-r_ti" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="instantaneous-reproduction-number-r_ti"><span class="header-section-number">12.1</span> Instantaneous reproduction number <span class="math inline">\(R_t^i\)</span></h2>
<div id="def-rt-inst" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 12.1</strong></span> The instantaneous reproduction number is the expected number of secondary infections occurring at time <span class="math inline">\(t\)</span>, divided by the number of infected individuals, each scaled by their relative infectiousness at time <span class="math inline">\(t\)</span> (an individual’s relative infectiousness is based on the generation interval and time since infection) <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</div>
<section id="exact-calculation" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="exact-calculation"><span class="header-section-number">12.1.1</span> Exact calculation</h3>
<p>For a compartmental model (SIR or SEIR), <span class="math inline">\(R_t^i\)</span> can be calculated exactly as <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<p><span class="math display">\[R_t^i = \beta(t) S(t) D\]</span></p>
<ul>
<li><span class="math inline">\(\beta(t)\)</span>: the time-varying transmission rate.</li>
<li><span class="math inline">\(S(t)\)</span>: the fraction of the population that is susceptible.</li>
<li><span class="math inline">\(D\)</span>: the mean duration of infectiousness.</li>
</ul>
</section>
<section id="sec-cori" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="sec-cori"><span class="header-section-number">12.1.2</span> Cori method</h3>
<p><span class="math display">\[R_t^i = \frac{I_t}{\sum_{s = 1}^{t} I_{t - s} w_s}\]</span></p>
<ul>
<li><span class="math inline">\(I_t\)</span>: the number of infection on day <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(I_{t - s}\)</span>: the number of individuals who became infected <span class="math inline">\(s\)</span> days in the past.</li>
<li><span class="math inline">\(w_s\)</span>: the infectivity profile, describes how infectious an individual is <span class="math inline">\(s\)</span> days since infection, <span class="math inline">\(w_s\)</span> dependent on time since infection <span class="math inline">\(s\)</span> but independent of calendar time <span class="math inline">\(t\)</span>, and often be approximated by the generation interval <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>.</li>
<li><span class="math inline">\(I_{t - s} w_s\)</span>: we scale the number of individuals who became infected <span class="math inline">\(s\)</span> days in the past by how infectiousness are they still on day <span class="math inline">\(t\)</span> (which is <span class="math inline">\(s\)</span> days after the date they got infected, <span class="math inline">\(w_s\)</span>).</li>
</ul>
<p>Looking back at <a href="#def-rt-inst" class="quarto-xref">Definition&nbsp;<span>12.1</span></a>, <span class="math inline">\(R_t^i\)</span> is the expected number of secondary infections occurring at time <span class="math inline">\(t\)</span> (<span class="math inline">\(I_t\)</span>), divided by the number of infected individuals (<span class="math inline">\(\sum_{s = 1}^{t} I_{t - s}\)</span>), each scaled by their relative infectiousness at time <span class="math inline">\(t\)</span> (<span class="math inline">\(w_s\)</span>).</p>
<p>The only parametric assumption required by this method is <strong>the form of the generation interval</strong>. The standard assumption is that <span class="math inline">\(w_s\)</span> follows a <strong>discretized gamma distribution</strong>, but any parametric or empirical discrete distribution also work <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proofs
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The renewal equation (also called the Euler-Lotka equation <span class="citation" data-cites="wallinga2006">(<a href="references.html#ref-wallinga2006" role="doc-biblioref">Wallinga &amp; Lipsitch, 2006</a>)</span>) is a cornerstone of demographic theory and backbone of the <span class="math inline">\(R_t\)</span> estimators.</p>
<p><span class="math display">\[b(t) = \int_{a = 0}^{\infty} b(t - a) n(a) da\]</span></p>
<ul>
<li><span class="math inline">\(b(t)\)</span>: the number of female offspring at time <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(b(t - a)\)</span>: the number of mothers of age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span>, which is equal to the number of female offspring at time <span class="math inline">\(t - a\)</span>.</li>
<li><span class="math inline">\(n(a)\)</span>: the birth ability of mothers of age <span class="math inline">\(a\)</span>, scaled by the probability of surviving to age <span class="math inline">\(a\)</span>.</li>
<li><span class="math inline">\(\int_{a = 0}^{\infty}\)</span>: summing these female offspring over all possible mothers’ ages, we obtain the total number of female offspring at time <span class="math inline">\(t\)</span> which is <span class="math inline">\(b(t)\)</span>.</li>
</ul>
<p>This equation assume that the population displays exponential growth at a fixed growth rate and that the age distribution of the population does not change over time <span class="citation" data-cites="wallinga2006">(<a href="references.html#ref-wallinga2006" role="doc-biblioref">Wallinga &amp; Lipsitch, 2006</a>)</span>.</p>
<p>To describe epidemic dynamics, the renewal equation is expressed in terms of <span class="math inline">\(I(t)\)</span>.</p>
<p><span class="math display">\[I(t) = R_0 S(t) \int_{s = 0}^{\infty} I(t - s) w_s ds\]</span></p>
<ul>
<li><span class="math inline">\(R_0 S(t) = R_t\)</span>: see <a href="rnum.html#def-rt" class="quarto-xref">Definition&nbsp;<span>3</span></a>.</li>
<li><span class="math inline">\(I(t - s)\)</span>: the number of individuals who became infected <span class="math inline">\(s\)</span> time points ago in the past.</li>
<li><span class="math inline">\(w_s\)</span>: the infectivity profile, or the probability of how infectiousness are they still at time <span class="math inline">\(t\)</span> (which is <span class="math inline">\(s\)</span> time points after the date they got infected).</li>
<li><span class="math inline">\(I(t - s) w_s\)</span>: we scale the number of individuals who in the past by how infectiousness are they still at time <span class="math inline">\(t\)</span>.</li>
</ul>
<p>Now we transform the equation a bit, and we got something very similar to the Cori method (see <a href="#sec-cori" class="quarto-xref"><span>Section 12.1.2</span></a>).</p>
<p><span class="math display">\[R_t = \frac{I(t)}{\int_{s = 0}^{\infty} I(t - s) w_s ds}\]</span></p>
</div>
</div>
</div>
</section>
<section id="when-can-we-start-estimating-r_ti" class="level3" data-number="12.1.3">
<h3 data-number="12.1.3" class="anchored" data-anchor-id="when-can-we-start-estimating-r_ti"><span class="header-section-number">12.1.3</span> When can we start estimating <span class="math inline">\(R_t^i\)</span>?</h3>
<p>Cori et al.&nbsp;suggest starting estimating <span class="math inline">\(R_t^i\)</span> once those three criteria are fulfilled <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>:</p>
<ul>
<li>At least after the sliding window size.</li>
<li>At least after one mean serial interval.</li>
<li>At least 12 cases (the initial case + 11) have been observed since the beginning of the epidemic (in a time window): to get a posterior credible interval of 0.3, the time window must comprise at least 11 incident cases.</li>
</ul>
</section>
<section id="key-considerations" class="level3" data-number="12.1.4">
<h3 data-number="12.1.4" class="anchored" data-anchor-id="key-considerations"><span class="header-section-number">12.1.4</span> Key considerations</h3>
<p>Source: Dr.&nbsp;Anne Cori’s <a href="https://www.youtube.com/watch?v=wv3BecZD5DU">webinar</a>.</p>
<ul>
<li>Temporal resolution: we can’t apply the <span class="math inline">\(R_t^i\)</span> method when the time step of observation is too large (&gt; mean generation interval).</li>
<li>Spatial resolution: ideally use a spatial scale that you can distinguish locally infected cases from imported cases.</li>
<li><span class="math inline">\(R_t^i\)</span> is very sensitive to the size of the sliding window: small windows can lead to highly variable estimates with wide credible intervals, whereas longer windows lead to smoothed estimates with narrower credible intervals. Perhaps also consider at least 11 incident cases in a sliding window to get a posterior credible interval of 0.3 <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>.</li>
</ul>
<p><img src="img/rnum/rt-window.png" class="img-fluid"></p>
</section>
</section>
<section id="case-reproduction-number-r_tc" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="case-reproduction-number-r_tc"><span class="header-section-number">12.2</span> Case reproduction number <span class="math inline">\(R_t^c\)</span></h2>
<div id="def-rt-case" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 12.2</strong></span> The case or cohort reproduction number is the expected number of secondary infections that an individual who becomes infected at time <span class="math inline">\(t\)</span> will eventually cause as they progress through their infection <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</div>
<section id="sec-rt-case-exact" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="sec-rt-case-exact"><span class="header-section-number">12.2.1</span> Exact calculation</h3>
<p><span class="math display">\[R_t^c = \int_{u = t}^{\infty} R_u^i w_{u-t} du\]</span></p>
<ul>
<li><span class="math inline">\(R_u^i\)</span>: the instantaneous reproduction number of current infected cases at time <span class="math inline">\(u\)</span>, starting from <span class="math inline">\(t\)</span> to the end of their infectious period <span class="math inline">\(\infty\)</span>.</li>
<li><span class="math inline">\(w_{u-t}\)</span>: the infectiousness of them at that time.</li>
</ul>
</section>
<section id="wallinga-and-teunis-method" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="wallinga-and-teunis-method"><span class="header-section-number">12.2.2</span> Wallinga and Teunis method</h3>
<p>There are 3 steps <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<p><strong>Step 1</strong>. Estimate the likelihood that case <span class="math inline">\(j\)</span> (infected at time <span class="math inline">\(t_j\)</span>) infected case <span class="math inline">\(i\)</span> (at time <span class="math inline">\(t_i\)</span>).</p>
<p><span class="math display">\[p_{ij} = \frac{w_{t_i - t_j}}{\sum_{i \neq k} w_{t_i - t_k}}\]</span></p>
<ul>
<li><span class="math inline">\(\sum_{i \neq k} w_{t_i - t_k}\)</span>: sum of the infectiousness of all cases (other than <span class="math inline">\(i\)</span>) infects case <span class="math inline">\(i\)</span>.</li>
</ul>
<p><strong>Step 2</strong>. Compute the individual reproduction number of case <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[R_j = \sum_i p_{ij}\]</span></p>
<p><strong>Step 3</strong>. Compute the case reproduction number at time <span class="math inline">\(t\)</span>, it is the expected value of <span class="math inline">\(R_j\)</span> for all individuals infected at time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[R_t^c = \mathbb{E}(R_j)\]</span></p>
</section>
</section>
<section id="compare-r_ti-and-r_tc" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="compare-r_ti-and-r_tc"><span class="header-section-number">12.3</span> Compare <span class="math inline">\(R_t^i\)</span> and <span class="math inline">\(R_t^c\)</span></h2>
<p>There are several important differences <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<ol type="1">
<li>Instantaneous <span class="math inline">\(R_t^i\)</span> is real-time estimation and only use data from before time <span class="math inline">\(t\)</span>, while case <span class="math inline">\(R_t^c\)</span> is inherently forward-looking.</li>
</ol>
<ul>
<li><p><strong>Instantaneous</strong> <span class="math inline">\(R_t^i\)</span> <strong>overestimates</strong> <span class="math inline">\(R_t\)</span> early in the time series, because any infections that occurred before the first observed date are missing terms in the denominator (the <span class="math inline">\(I_{t - s}\)</span> in <a href="#sec-cori" class="quarto-xref"><span>Section 12.1.2</span></a>, data is left-truncated at the beginning).</p></li>
<li><p><strong>Case</strong> <span class="math inline">\(R_t^c\)</span> <strong>underestimates</strong> <span class="math inline">\(R_t\)</span> at the end of the time series, because it relies on time points not yet observed which become missing terms in the integral (the <span class="math inline">\(R_u^i\)</span> in <a href="#sec-rt-case-exact" class="quarto-xref"><span>Section 12.2.1</span></a>, data is right-truncated at the end).</p></li>
</ul>
<ol start="2" type="1">
<li>Case <span class="math inline">\(R_t^c\)</span> is shifted forward in time relative to instantaneous <span class="math inline">\(R_t^i\)</span>, produces leading estimates of <span class="math inline">\(R_t\)</span> because it uses data from time points <strong>after</strong> <span class="math inline">\(t\)</span>, whereas the <span class="math inline">\(R_t^i\)</span> uses data from time points <strong>before</strong> <span class="math inline">\(t\)</span>.</li>
</ol>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Overall, <strong>for real-time analyses</strong> aiming to <strong>infer the impact of changes in policy</strong>, behavior, or other extrinsic factors on transmission, the <strong>instantaneous reproductive number</strong> will provide more temporally accurate estimates and is <strong>most appropriate</strong>.</p>
</div>
</div>
</div>
</section>
<section id="potential-biases" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="potential-biases"><span class="header-section-number">12.4</span> Potential biases</h2>
<p><span class="math inline">\(R_t\)</span> is a <strong>value</strong> in specific <strong>time</strong>, therefore there are 2 potential forms of bias in <span class="math inline">\(R_t\)</span> estimates <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<ul>
<li><p><strong>Accuracy</strong> (the value): Systematic over- or underestimation caused by misspecification of the generation interval. Mostly impact when <span class="math inline">\(R_t\)</span> is substantially &gt; 1 (e.g., the beginning of COVID-19 when <span class="math inline">\(R_t\)</span> is relatively high) or &lt; 1 (e.g., after a very effective intervention then <span class="math inline">\(R_t\)</span> might be low).</p></li>
<li><p><strong>Timeliness</strong> (the time): Temporal inaccuracy that <span class="math inline">\(R_t\)</span> estimates may be leading or lagging the true date, has several possible causes and can be difficult to avoid.</p></li>
</ul>
<section id="generation-interval" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="generation-interval"><span class="header-section-number">12.4.1</span> Generation interval</h3>
<p>See <a href="gen-int.html#def-gen-int" class="quarto-xref">Definition&nbsp;<span>10.1</span></a> to recall the definition of generation interval.</p>
<p><img src="img/rnum/mean-gen-int-bias.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Biases from misspecification of the generation interval mean (A) or variance (B) <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</blockquote>
<ul>
<li>If <strong>mean</strong> generation interval is set <strong>too high</strong>, <span class="math inline">\(R_t\)</span> will be <strong>more extreme</strong> (too high when true <span class="math inline">\(R_t &gt; 1\)</span> and too low when true <span class="math inline">\(R_t &lt; 1\)</span>).</li>
<li>If <strong>mean</strong> generation interval is set <strong>too low</strong>, <span class="math inline">\(R_t\)</span> will be <strong>closer to 1</strong> than the true value.</li>
<li>The effect of the mean generation interval is large when true <span class="math inline">\(R_t\)</span> further from 1. Therefore, <strong>this bias may be greatest at the early epidemic</strong>, when true <span class="math inline">\(R_t\)</span> is high, together with highly uncertain generation interval and limited data.</li>
</ul>
<p>Tools like <code>EpiEstim</code> and <code>EpiNow2</code> allow users to specify the prior variance of the mean and standard deviation. However, bear in mind that uncertainty around an incorrect generation interval only widen the 95% credible interval, but will not shift the estimates toward the truth and will not correct this bias.</p>
</section>
<section id="delays" class="level3" data-number="12.4.2">
<h3 data-number="12.4.2" class="anchored" data-anchor-id="delays"><span class="header-section-number">12.4.2</span> Delays</h3>
<p><img src="img/rnum/delays.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Adjusting for delays <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</blockquote>
<p>If <span class="math inline">\(d\)</span> is the delay from infection to observation, then observations at time <span class="math inline">\(t\)</span> inform <span class="math inline">\(R_{t − d}\)</span>, not <span class="math inline">\(R_t\)</span>.</p>
<p>If the distribution of delays can be estimated, then <span class="math inline">\(R_t\)</span> can be estimated in 2 steps:</p>
<ol type="1">
<li>Infer the underlying time series of infections.</li>
<li>Input the adjusted time series into an <span class="math inline">\(R_t\)</span> estimation method.</li>
</ol>
</section>
</section>
<section id="code" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="code"><span class="header-section-number">12.5</span> Code</h2>
<section id="epiestim" class="level3" data-number="12.5.1">
<h3 data-number="12.5.1" class="anchored" data-anchor-id="epiestim"><span class="header-section-number">12.5.1</span> EpiEstim</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EpiEstim)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The input data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Flu2009)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Flu2009<span class="sc">$</span>incidence</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["dates"],"name":[1],"type":["date"],"align":["right"]},{"label":["I"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"2009-04-27","2":"1","_rn_":"1"},{"1":"2009-04-28","2":"1","_rn_":"2"},{"1":"2009-04-29","2":"0","_rn_":"3"},{"1":"2009-04-30","2":"2","_rn_":"4"},{"1":"2009-05-01","2":"5","_rn_":"5"},{"1":"2009-05-02","2":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Let have a look at the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> dates, <span class="at">y =</span> I)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Day"</span>, <span class="at">y =</span> <span class="st">"Incidence"</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rt_files/figure-html/unnamed-chunk-3-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="section" class="level4" data-number="12.5.1.1">
<h4 data-number="12.5.1.1" class="anchored" data-anchor-id="section"><span class="header-section-number">12.5.1.1</span> </h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate_R</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">incid =</span> df, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"parametric_si"</span>, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> <span class="fu">make_config</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_si =</span> <span class="fl">2.6</span>, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">std_si =</span> <span class="fl">1.5</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Default config will estimate R on weekly sliding windows.
    To change this change the t_start and t_end arguments. </code></pre>
</div>
</div>
<p>Noted that the default config will estimate R on weekly sliding windows (day 2 to day 8).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mod<span class="sc">$</span>R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["t_start"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["t_end"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Mean(R)"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Std(R)"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.025(R)"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.05(R)"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.25(R)"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Median(R)"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.75(R)"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.95(R)"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.975(R)"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"8","3":"1.735798","4":"0.4091314","5":"1.0287437","6":"1.121933","7":"1.445198","8":"1.703761","9":"1.991520","10":"2.458972","11":"2.624781","_rn_":"1"},{"1":"3","2":"9","3":"1.749168","4":"0.3647267","5":"1.1088223","6":"1.195480","7":"1.491345","8":"1.723884","9":"1.979457","10":"2.389121","11":"2.533119","_rn_":"2"},{"1":"4","2":"10","3":"1.537058","4":"0.3074116","5":"0.9947030","6":"1.068694","7":"1.320090","8":"1.516613","9":"1.731761","10":"2.075176","11":"2.195540","_rn_":"3"},{"1":"5","2":"11","3":"1.431839","4":"0.2705921","5":"0.9514466","6":"1.017661","7":"1.241251","8":"1.414830","9":"1.603900","10":"1.904047","11":"2.008849","_rn_":"4"},{"1":"6","2":"12","3":"1.422725","4":"0.2515046","5":"0.9731426","6":"1.035808","7":"1.245996","8":"1.407932","9":"1.583340","10":"1.860107","11":"1.956336","_rn_":"5"},{"1":"7","2":"13","3":"1.635373","4":"0.2523436","5":"1.1786332","6":"1.243590","7":"1.458847","8":"1.622413","9":"1.797779","10":"2.071372","11":"2.165745","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rt_files/figure-html/unnamed-chunk-6-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> df[df<span class="sc">$</span>dates <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-11"</span>),]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate_R</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">incid =</span> tmp, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"parametric_si"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> <span class="fu">make_config</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_si =</span> <span class="fl">2.6</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">std_si =</span> <span class="fl">1.5</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Default config will estimate R on weekly sliding windows.
    To change this change the t_start and t_end arguments. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mod<span class="sc">$</span>R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["t_start"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["t_end"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Mean(R)"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Std(R)"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.025(R)"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.05(R)"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.25(R)"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Median(R)"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.75(R)"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.95(R)"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["Quantile.0.975(R)"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"8","3":"1.735798","4":"0.4091314","5":"1.0287437","6":"1.121933","7":"1.445198","8":"1.703761","9":"1.991520","10":"2.458972","11":"2.624781","_rn_":"1"},{"1":"3","2":"9","3":"1.749168","4":"0.3647267","5":"1.1088223","6":"1.195480","7":"1.491345","8":"1.723884","9":"1.979457","10":"2.389121","11":"2.533119","_rn_":"2"},{"1":"4","2":"10","3":"1.537058","4":"0.3074116","5":"0.9947030","6":"1.068694","7":"1.320090","8":"1.516613","9":"1.731761","10":"2.075176","11":"2.195540","_rn_":"3"},{"1":"5","2":"11","3":"1.431839","4":"0.2705921","5":"0.9514466","6":"1.017661","7":"1.241251","8":"1.414830","9":"1.603900","10":"1.904047","11":"2.008849","_rn_":"4"},{"1":"6","2":"12","3":"1.422725","4":"0.2515046","5":"0.9731426","6":"1.035808","7":"1.245996","8":"1.407932","9":"1.583340","10":"1.860107","11":"1.956336","_rn_":"5"},{"1":"7","2":"13","3":"1.635373","4":"0.2523436","5":"1.1786332","6":"1.243590","7":"1.458847","8":"1.622413","9":"1.797779","10":"2.071372","11":"2.165745","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rt_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="epinow2" class="level3" data-number="12.5.2">
<h3 data-number="12.5.2" class="anchored" data-anchor-id="epinow2"><span class="header-section-number">12.5.2</span> EpiNow2</h3>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-cori2013" class="csl-entry" role="listitem">
Cori, A., Ferguson, N. M., Fraser, C., &amp; Cauchemez, S. (2013). A new framework and software to estimate time-varying reproduction numbers during epidemics. <em>American Journal of Epidemiology</em>, <em>178</em>(9), 1505–1512. <a href="https://doi.org/10.1093/aje/kwt133">https://doi.org/10.1093/aje/kwt133</a>
</div>
<div id="ref-gostic2020" class="csl-entry" role="listitem">
Gostic, K. M., McGough, L., Baskerville, E. B., Abbott, S., Joshi, K., Tedijanto, C., Kahn, R., Niehus, R., Hay, J. A., Salazar, P. M. D., Hellewell, J., Meakin, S., Munday, J. D., Bosse, N. I., Sherrat, K., Thompson, R. N., White, L. F., Huisman, J. S., Scire, J., … Cobey, S. (2020). Practical considerations for measuring the effective reproductive number, Rt. <em>PLOS Computational Biology</em>, <em>16</em>(12), e1008409. <a href="https://doi.org/10.1371/journal.pcbi.1008409">https://doi.org/10.1371/journal.pcbi.1008409</a>
</div>
<div id="ref-wallinga2006" class="csl-entry" role="listitem">
Wallinga, J., &amp; Lipsitch, M. (2006). How generation intervals shape the relationship between growth rates and reproductive numbers. <em>Proceedings of the Royal Society B: Biological Sciences</em>, <em>274</em>(1609), 599–604. <a href="https://doi.org/10.1098/rspb.2006.3754">https://doi.org/10.1098/rspb.2006.3754</a>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="thinhong/idm4b" data-repo-id="R_kgDOL-8Pvg" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./r0.html" class="pagination-link" aria-label="Estimating $R_0$">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_0\)</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./rt-prac.html" class="pagination-link" aria-label="$R_t$ in practice">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title"><span class="math inline">\(R_t\)</span> in practice</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>