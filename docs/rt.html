<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Infectious disease modelling for babies - 3&nbsp; Estimating \(R_t\)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./det.html" rel="next">
<link href="./r0.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X391ZN63GG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-X391ZN63GG', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rnum.html">Reproduction number</a></li><li class="breadcrumb-item"><a href="./rt.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Infectious disease modelling for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Infectious disease modelling</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rnum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reproduction number</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_0\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rt.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./det.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deterministic models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sir-det.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">SIR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tsir.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">tsiR</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stochastic models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sir-sto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">SIR</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./calib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calibration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pomp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Particle filter</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reports</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rp-risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Risk assessment report</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#methods" id="toc-methods" class="nav-link active" data-scroll-target="#methods"><span class="header-section-number">3.1</span> Methods</a>
  <ul>
  <li><a href="#instantaneous-reproduction-number-r_ti" id="toc-instantaneous-reproduction-number-r_ti" class="nav-link" data-scroll-target="#instantaneous-reproduction-number-r_ti"><span class="header-section-number">3.1.1</span> Instantaneous reproduction number <span class="math inline">\(R_t^i\)</span></a>
  <ul>
  <li><a href="#exact-calculation" id="toc-exact-calculation" class="nav-link" data-scroll-target="#exact-calculation"><span class="header-section-number">3.1.1.1</span> Exact calculation</a></li>
  <li><a href="#sec-cori" id="toc-sec-cori" class="nav-link" data-scroll-target="#sec-cori"><span class="header-section-number">3.1.1.2</span> Cori method</a></li>
  <li><a href="#when-can-we-start-estimating-r_ti" id="toc-when-can-we-start-estimating-r_ti" class="nav-link" data-scroll-target="#when-can-we-start-estimating-r_ti"><span class="header-section-number">3.1.1.3</span> When can we start estimating <span class="math inline">\(R_t^i\)</span>?</a></li>
  <li><a href="#key-considerations" id="toc-key-considerations" class="nav-link" data-scroll-target="#key-considerations"><span class="header-section-number">3.1.1.4</span> Key considerations</a></li>
  </ul></li>
  <li><a href="#case-reproduction-number-r_tc" id="toc-case-reproduction-number-r_tc" class="nav-link" data-scroll-target="#case-reproduction-number-r_tc"><span class="header-section-number">3.1.2</span> Case reproduction number <span class="math inline">\(R_t^c\)</span></a>
  <ul>
  <li><a href="#sec-rt-case-exact" id="toc-sec-rt-case-exact" class="nav-link" data-scroll-target="#sec-rt-case-exact"><span class="header-section-number">3.1.2.1</span> Exact calculation</a></li>
  <li><a href="#wallinga-and-teunis-method" id="toc-wallinga-and-teunis-method" class="nav-link" data-scroll-target="#wallinga-and-teunis-method"><span class="header-section-number">3.1.2.2</span> Wallinga and Teunis method</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#proofs" id="toc-proofs" class="nav-link" data-scroll-target="#proofs"><span class="header-section-number">3.2</span> Proofs</a></li>
  <li><a href="#compare-r_ti-and-r_tc" id="toc-compare-r_ti-and-r_tc" class="nav-link" data-scroll-target="#compare-r_ti-and-r_tc"><span class="header-section-number">3.3</span> Compare <span class="math inline">\(R_t^i\)</span> and <span class="math inline">\(R_t^c\)</span></a></li>
  <li><a href="#potential-biases" id="toc-potential-biases" class="nav-link" data-scroll-target="#potential-biases"><span class="header-section-number">3.4</span> Potential biases</a>
  <ul>
  <li><a href="#generation-interval" id="toc-generation-interval" class="nav-link" data-scroll-target="#generation-interval"><span class="header-section-number">3.4.1</span> Generation interval</a></li>
  <li><a href="#serial-interval" id="toc-serial-interval" class="nav-link" data-scroll-target="#serial-interval"><span class="header-section-number">3.4.2</span> Serial interval</a></li>
  <li><a href="#delays" id="toc-delays" class="nav-link" data-scroll-target="#delays"><span class="header-section-number">3.4.3</span> Delays</a></li>
  </ul></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code"><span class="header-section-number">3.5</span> Code</a>
  <ul>
  <li><a href="#epinow2" id="toc-epinow2" class="nav-link" data-scroll-target="#epinow2"><span class="header-section-number">3.5.1</span> EpiNow2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rnum.html">Reproduction number</a></li><li class="breadcrumb-item"><a href="./rt.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_t\)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="methods" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="methods"><span class="header-section-number">3.1</span> Methods</h2>
<p><span class="math inline">\(R_t\)</span> can be defined in 2 ways: as the <strong>instantaneous reproduction number</strong> (see <a href="rnum.html#sec-rt-inst" class="quarto-xref"><span>Section 3.1</span></a>) or as the <strong>case reproduction number</strong> (see <a href="rnum.html#sec-rt-case" class="quarto-xref"><span>Section 3.2</span></a>).</p>
<section id="instantaneous-reproduction-number-r_ti" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="instantaneous-reproduction-number-r_ti"><span class="header-section-number">3.1.1</span> Instantaneous reproduction number <span class="math inline">\(R_t^i\)</span></h3>
<div id="def-rt-inst" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.1</strong></span> The instantaneous reproduction number is the expected number of secondary infections occurring at time <span class="math inline">\(t\)</span>, divided by the number of infected individuals, each scaled by their relative infectiousness at time <span class="math inline">\(t\)</span> (an individual’s relative infectiousness is based on the generation interval and time since infection) <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</div>
<section id="exact-calculation" class="level4" data-number="3.1.1.1">
<h4 data-number="3.1.1.1" class="anchored" data-anchor-id="exact-calculation"><span class="header-section-number">3.1.1.1</span> Exact calculation</h4>
<p>For a compartmental model (SIR or SEIR), <span class="math inline">\(R_t^i\)</span> can be calculated exactly as <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<p><span class="math display">\[R_t^i = \beta(t) S(t) D\]</span></p>
<ul>
<li><span class="math inline">\(\beta(t)\)</span>: the time-varying transmission rate.</li>
<li><span class="math inline">\(S(t)\)</span>: the fraction of the population that is susceptible.</li>
<li><span class="math inline">\(D\)</span>: the mean duration of infectiousness.</li>
</ul>
</section>
<section id="sec-cori" class="level4" data-number="3.1.1.2">
<h4 data-number="3.1.1.2" class="anchored" data-anchor-id="sec-cori"><span class="header-section-number">3.1.1.2</span> Cori method</h4>
<p><span class="math display">\[R_t^i = \frac{I_t}{\sum_{s = 1}^{t} I_{t - s} w_s}\]</span></p>
<ul>
<li><span class="math inline">\(I_t\)</span>: the number of infection on day <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(I_{t - s}\)</span>: the number of individuals who became infected <span class="math inline">\(s\)</span> days in the past.</li>
<li><span class="math inline">\(w_s\)</span>: the infectivity profile, describes how infectious an individual is <span class="math inline">\(s\)</span> days since infection, <span class="math inline">\(w_s\)</span> dependent on time since infection <span class="math inline">\(s\)</span> but independent of calendar time <span class="math inline">\(t\)</span>, and often be approximated by the generation interval <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>.</li>
<li><span class="math inline">\(I_{t - s} w_s\)</span>: we scale the number of individuals who became infected <span class="math inline">\(s\)</span> days in the past by how infectiousness are they still on day <span class="math inline">\(t\)</span> (which is <span class="math inline">\(s\)</span> days after the date they got infected, <span class="math inline">\(w_s\)</span>).</li>
</ul>
<p>Looking back at <a href="#def-rt-inst" class="quarto-xref">Definition&nbsp;<span>3.1</span></a>, <span class="math inline">\(R_t^i\)</span> is the expected number of secondary infections occurring at time <span class="math inline">\(t\)</span> (<span class="math inline">\(I_t\)</span>), divided by the number of infected individuals (<span class="math inline">\(\sum_{s = 1}^{t} I_{t - s}\)</span>), each scaled by their relative infectiousness at time <span class="math inline">\(t\)</span> (<span class="math inline">\(w_s\)</span>).</p>
<p>The only parametric assumption required by this method is <strong>the form of the generation interval</strong>. The standard assumption is that <span class="math inline">\(w_s\)</span> follows a <strong>discretized gamma distribution</strong>, but any parametric or empirical discrete distribution also work <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</section>
<section id="when-can-we-start-estimating-r_ti" class="level4" data-number="3.1.1.3">
<h4 data-number="3.1.1.3" class="anchored" data-anchor-id="when-can-we-start-estimating-r_ti"><span class="header-section-number">3.1.1.3</span> When can we start estimating <span class="math inline">\(R_t^i\)</span>?</h4>
<p>Cori et al.&nbsp;suggest starting estimating <span class="math inline">\(R_t^i\)</span> once those three criteria are fulfilled <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>:</p>
<ul>
<li>At least after the sliding window size.</li>
<li>At least after one mean serial interval.</li>
<li>At least 12 cases (the initial case + 11) have been observed since the beginning of the epidemic (in a time window): to get a posterior credible interval of 0.3, the time window must comprise at least 11 incident cases.</li>
</ul>
</section>
<section id="key-considerations" class="level4" data-number="3.1.1.4">
<h4 data-number="3.1.1.4" class="anchored" data-anchor-id="key-considerations"><span class="header-section-number">3.1.1.4</span> Key considerations</h4>
<p>Source: Dr.&nbsp;Anne Cori’s <a href="https://www.youtube.com/watch?v=wv3BecZD5DU">webinar</a>.</p>
<ul>
<li>Temporal resolution: we can’t apply the <span class="math inline">\(R_t^i\)</span> method when the time step of observation is too large (&gt; mean generation interval).</li>
<li>Spatial resolution: ideally use a spatial scale that you can distinguish locally infected cases from imported cases.</li>
<li><span class="math inline">\(R_t^i\)</span> is very sensitive to the size of the sliding window: small windows can lead to highly variable estimates with wide credible intervals, whereas longer windows lead to smoothed estimates with narrower credible intervals. Perhaps also consider at least 11 incident cases in a sliding window to get a posterior credible interval of 0.3 <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>.</li>
</ul>
<p><img src="img/rnum/rt-window.png" class="img-fluid"></p>
</section>
</section>
<section id="case-reproduction-number-r_tc" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="case-reproduction-number-r_tc"><span class="header-section-number">3.1.2</span> Case reproduction number <span class="math inline">\(R_t^c\)</span></h3>
<div id="def-rt-case" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.2</strong></span> The case or cohort reproduction number is the expected number of secondary infections that an individual who becomes infected at time <span class="math inline">\(t\)</span> will eventually cause as they progress through their infection <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</div>
<section id="sec-rt-case-exact" class="level4" data-number="3.1.2.1">
<h4 data-number="3.1.2.1" class="anchored" data-anchor-id="sec-rt-case-exact"><span class="header-section-number">3.1.2.1</span> Exact calculation</h4>
<p><span class="math display">\[R_t^c = \int_{u = t}^{\infty} R_u^i w_{u-t} du\]</span></p>
<ul>
<li><span class="math inline">\(R_u^i\)</span>: the instantaneous reproduction number of current infected cases at time <span class="math inline">\(u\)</span>, starting from <span class="math inline">\(t\)</span> to the end of their infectious period <span class="math inline">\(\infty\)</span>.</li>
<li><span class="math inline">\(w_{u-t}\)</span>: the infectiousness of them at that time.</li>
</ul>
</section>
<section id="wallinga-and-teunis-method" class="level4" data-number="3.1.2.2">
<h4 data-number="3.1.2.2" class="anchored" data-anchor-id="wallinga-and-teunis-method"><span class="header-section-number">3.1.2.2</span> Wallinga and Teunis method</h4>
<p>There are 3 steps <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<p><strong>Step 1</strong>. Estimate the likelihood that case <span class="math inline">\(j\)</span> (infected at time <span class="math inline">\(t_j\)</span>) infected case <span class="math inline">\(i\)</span> (at time <span class="math inline">\(t_i\)</span>).</p>
<p><span class="math display">\[p_{ij} = \frac{w_{t_i - t_j}}{\sum_{i \neq k} w_{t_i - t_k}}\]</span></p>
<ul>
<li><span class="math inline">\(\sum_{i \neq k} w_{t_i - t_k}\)</span>: sum of the infectiousness of all cases (other than <span class="math inline">\(i\)</span>) infects case <span class="math inline">\(i\)</span>.</li>
</ul>
<p><strong>Step 2</strong>. Compute the individual reproduction number of case <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[R_j = \sum_i p_{ij}\]</span></p>
<p><strong>Step 3</strong>. Compute the case reproduction number at time <span class="math inline">\(t\)</span>, it is the expected value of <span class="math inline">\(R_j\)</span> for all individuals infected at time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[R_t^c = \mathbb{E}(R_j)\]</span></p>
</section>
</section>
</section>
<section id="proofs" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="proofs"><span class="header-section-number">3.2</span> Proofs</h2>
<p>The renewal equation is a cornerstone of demographic theory and backbone of the <span class="math inline">\(R_t\)</span> estimators.</p>
<p><span class="math display">\[b(t) = \int_{a = 0}^{\infty} b(t - a) n(a) da\]</span></p>
<ul>
<li><span class="math inline">\(b(t)\)</span>: the number of births at time <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(b(t - a)\)</span>: the number of birth at time <span class="math inline">\(t - a\)</span>, or the number of people of age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(n(a)\)</span>: the birth ability of people of age <span class="math inline">\(a\)</span>, scaled by the probability of surviving to age <span class="math inline">\(a\)</span>.</li>
</ul>
<p>To describe epidemic dynamics, the renewal equation is expressed in terms of <span class="math inline">\(I(t)\)</span>.</p>
<p><span class="math display">\[I(t) = R_0 S(t) \int_{s = 0}^{\infty} I(t - s) w_s ds\]</span></p>
<ul>
<li><span class="math inline">\(R_0 S(t) = R_t\)</span>: see <a href="rnum.html#def-rt" class="quarto-xref">Definition&nbsp;<span>3</span></a>.</li>
<li><span class="math inline">\(I(t - s)\)</span>: the number of individuals who became infected <span class="math inline">\(s\)</span> time points ago in the past.</li>
<li><span class="math inline">\(w_s\)</span>: the infectivity profile, or the probability of how infectiousness are they still at time <span class="math inline">\(t\)</span> (which is <span class="math inline">\(s\)</span> time points after the date they got infected).</li>
<li><span class="math inline">\(I(t - s) w_s\)</span>: we scale the number of individuals who in the past by how infectiousness are they still at time <span class="math inline">\(t\)</span>.</li>
</ul>
<p>Now we transform the equation a bit, and we got something very similar to the Cori method (see <a href="#sec-cori" class="quarto-xref"><span>Section 3.1.1.2</span></a>).</p>
<p><span class="math display">\[R_t = \frac{I(t)}{\int_{s = 0}^{\infty} I(t - s) w_s ds}\]</span></p>
</section>
<section id="compare-r_ti-and-r_tc" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="compare-r_ti-and-r_tc"><span class="header-section-number">3.3</span> Compare <span class="math inline">\(R_t^i\)</span> and <span class="math inline">\(R_t^c\)</span></h2>
<p>There are several important differences <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<ol type="1">
<li>Instantaneous <span class="math inline">\(R_t^i\)</span> is real-time estimation and only use data from before time <span class="math inline">\(t\)</span>, while case <span class="math inline">\(R_t^c\)</span> is inherently forward-looking.</li>
</ol>
<ul>
<li><p><strong>Instantaneous</strong> <span class="math inline">\(R_t^i\)</span> <strong>overestimates</strong> <span class="math inline">\(R_t\)</span> early in the time series, because any infections that occurred before the first observed date are missing terms in the denominator (the <span class="math inline">\(I_{t - s}\)</span> in <a href="#sec-cori" class="quarto-xref"><span>Section 3.1.1.2</span></a>, data is left-truncated at the beginning).</p></li>
<li><p><strong>Case</strong> <span class="math inline">\(R_t^c\)</span> <strong>underestimates</strong> <span class="math inline">\(R_t\)</span> at the end of the time series, because it relies on time points not yet observed which become missing terms in the integral (the <span class="math inline">\(R_u^i\)</span> in <a href="#sec-rt-case-exact" class="quarto-xref"><span>Section 3.1.2.1</span></a>, data is right-truncated at the end).</p></li>
</ul>
<ol start="2" type="1">
<li>Case <span class="math inline">\(R_t^c\)</span> is shifted forward in time relative to instantaneous <span class="math inline">\(R_t^i\)</span>, produces leading estimates of <span class="math inline">\(R_t\)</span> because it uses data from time points <strong>after</strong> <span class="math inline">\(t\)</span>, whereas the <span class="math inline">\(R_t^i\)</span> uses data from time points <strong>before</strong> <span class="math inline">\(t\)</span>.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Overall, <strong>for real-time analyses</strong> aiming to <strong>infer the impact of changes in policy</strong>, behavior, or other extrinsic factors on transmission, the <strong>instantaneous reproductive number</strong> will provide more temporally accurate estimates and is <strong>most appropriate</strong>.</p>
</div>
</div>
</section>
<section id="potential-biases" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="potential-biases"><span class="header-section-number">3.4</span> Potential biases</h2>
<p><span class="math inline">\(R_t\)</span> is a <strong>value</strong> in specific <strong>time</strong>, therefore there are 2 potential forms of bias in <span class="math inline">\(R_t\)</span> estimates <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<ul>
<li><p><strong>Accuracy</strong> (the value): Systematic over- or underestimation caused by misspecification of the generation interval. Mostly impact when <span class="math inline">\(R_t\)</span> is substantially &gt; 1 (e.g., the beginning of COVID-19 when <span class="math inline">\(R_t\)</span> is relatively high) or &lt; 1 (e.g., after a very effective intervention then <span class="math inline">\(R_t\)</span> might be low).</p></li>
<li><p><strong>Timeliness</strong> (the time): Temporal inaccuracy that <span class="math inline">\(R_t\)</span> estimates may be leading or lagging the true date, has several possible causes and can be difficult to avoid.</p></li>
</ul>
<p><img src="img/rnum/gen-ser-int.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Figure from Sender et al. <span class="citation" data-cites="sender2022">(<a href="references.html#ref-sender2022" role="doc-biblioref">Sender et al., 2022</a>)</span>.</p>
</blockquote>
<section id="generation-interval" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="generation-interval"><span class="header-section-number">3.4.1</span> Generation interval</h3>
<div id="def-gen-int" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.3</strong></span> Generation interval is the time from the infection of a primary case to infection of the cases he/she generates <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>.</p>
</div>
<p>If we match this to an SEIR model, the generation interval starts when the infector enters the E compartment (meaning they got infected). The latest time they can infect an infectee is at the end of their residence in the I compartment (they are infectious). Therefore, generation interval is the sum of residence times in compartments E and I <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
<p>The mean generation interval <strong>decreases</strong> when susceptible persons are at risk of infectious contact from <strong>multiple sources</strong>. Because when a susceptible person has multiple potential infectors, there is a “race” to infect him/her in which only the first infectious contact leads to infection <span class="citation" data-cites="kenah2008">(<a href="references.html#ref-kenah2008" role="doc-biblioref">Kenah et al., 2008</a>)</span>.</p>
<p><img src="img/rnum/mean-gen-int-bias.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Biases from misspecification of the generation interval mean (A) or variance (B) <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</blockquote>
<ul>
<li>If <strong>mean</strong> generation interval is set <strong>too high</strong>, <span class="math inline">\(R_t\)</span> will be <strong>more extreme</strong> (too high when true <span class="math inline">\(R_t &gt; 1\)</span> and too low when true <span class="math inline">\(R_t &lt; 1\)</span>).</li>
<li>If <strong>mean</strong> generation interval is set <strong>too low</strong>, <span class="math inline">\(R_t\)</span> will be <strong>closer to 1</strong> than the true value.</li>
<li>The effect of the mean generation interval is large when true <span class="math inline">\(R_t\)</span> further from 1. Therefore, <strong>this bias may be greatest at the early epidemic</strong>, when true <span class="math inline">\(R_t\)</span> is high, together with highly uncertain generation interval and limited data.</li>
</ul>
<p>Tools like <code>EpiEstim</code> and <code>EpiNow2</code> allow users to specify the prior variance of the mean and standard deviation. However, bear in mind that uncertainty around an incorrect generation interval only widen the 95% credible interval, but will not shift the estimates toward the truth and will not correct this bias.</p>
</section>
<section id="serial-interval" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="serial-interval"><span class="header-section-number">3.4.2</span> Serial interval</h3>
<div id="def-ser-int" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.4</strong></span> Serial interval is the time between symptom onset in an infector–infectee pair <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</div>
<p>Serial interval is more easily observed than generation interval and often used in its place. Although the serial and generation intervals are often conflated, there are important differences <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>:</p>
<ul>
<li>Serial interval and generation interval usually have the same mean, but different variances.</li>
<li>Serial interval can be negative (when the symptom onset of infector is later than infectee, such as in COVID-19), generation interval is always positive.</li>
</ul>
<p>The distributions of the serial interval and the generation interval are identical in these scenarios <span class="citation" data-cites="cori2013">(<a href="references.html#ref-cori2013" role="doc-biblioref">Cori et al., 2013</a>)</span>:</p>
<ul>
<li>For diseases such as influenza, SARS, measles, and smallpox, it is expected that infectiousness starts only around the time of symptom onset.</li>
<li>When the infectiousness profile after symptoms is independent of the incubation period.</li>
</ul>
</section>
<section id="delays" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="delays"><span class="header-section-number">3.4.3</span> Delays</h3>
<p><img src="img/rnum/delays.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Adjusting for delays <span class="citation" data-cites="gostic2020">(<a href="references.html#ref-gostic2020" role="doc-biblioref">Gostic et al., 2020</a>)</span>.</p>
</blockquote>
<p>If <span class="math inline">\(d\)</span> is the delay from infection to observation, then observations at time <span class="math inline">\(t\)</span> inform <span class="math inline">\(R_{t − d}\)</span>, not <span class="math inline">\(R_t\)</span>.</p>
<p>If the distribution of delays can be estimated, then <span class="math inline">\(R_t\)</span> can be estimated in 2 steps:</p>
<ol type="1">
<li>Infer the underlying time series of infections.</li>
<li>Input the adjusted time series into an <span class="math inline">\(R_t\)</span> estimation method.</li>
</ol>
</section>
</section>
<section id="code" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="code"><span class="header-section-number">3.5</span> Code</h2>
<section id="epinow2" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="epinow2"><span class="header-section-number">3.5.1</span> EpiNow2</h3>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-cori2013" class="csl-entry" role="listitem">
Cori, A., Ferguson, N. M., Fraser, C., &amp; Cauchemez, S. (2013). A new framework and software to estimate time-varying reproduction numbers during epidemics. <em>American Journal of Epidemiology</em>, <em>178</em>(9), 1505–1512. <a href="https://doi.org/10.1093/aje/kwt133">https://doi.org/10.1093/aje/kwt133</a>
</div>
<div id="ref-gostic2020" class="csl-entry" role="listitem">
Gostic, K. M., McGough, L., Baskerville, E. B., Abbott, S., Joshi, K., Tedijanto, C., Kahn, R., Niehus, R., Hay, J. A., Salazar, P. M. D., Hellewell, J., Meakin, S., Munday, J. D., Bosse, N. I., Sherrat, K., Thompson, R. N., White, L. F., Huisman, J. S., Scire, J., … Cobey, S. (2020). Practical considerations for measuring the effective reproductive number, Rt. <em>PLOS Computational Biology</em>, <em>16</em>(12), e1008409. <a href="https://doi.org/10.1371/journal.pcbi.1008409">https://doi.org/10.1371/journal.pcbi.1008409</a>
</div>
<div id="ref-kenah2008" class="csl-entry" role="listitem">
Kenah, E., Lipsitch, M., &amp; Robins, J. M. (2008). Generation interval contraction and epidemic data analysis. <em>Mathematical Biosciences</em>, <em>213</em>(1), 71–79. <a href="https://doi.org/10.1016/j.mbs.2008.02.007">https://doi.org/10.1016/j.mbs.2008.02.007</a>
</div>
<div id="ref-sender2022" class="csl-entry" role="listitem">
Sender, R., Bar-On, Y., Park, S. W., Noor, E., Dushoff, J., &amp; Milo, R. (2022). The unmitigated profile of COVID-19 infectiousness. <em>eLife</em>, <em>11</em>, e79134. <a href="https://doi.org/10.7554/eLife.79134">https://doi.org/10.7554/eLife.79134</a>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="thinhong/idm4b" data-repo-id="R_kgDOL-8Pvg" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./r0.html" class="pagination-link" aria-label="Estimating $R_0$">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(R_0\)</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./det.html" class="pagination-link" aria-label="Deterministic models">
        <span class="nav-page-text">Deterministic models</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>